---
config:
  layout: dagre
  theme: base
---
flowchart TB
    subgraph subGraphScout["I. The Learning Scout"]
        direction TB
        Start["Session Start"] --> SeekTruth["MCP: cortex_learning_debrief"]
        SuccessorSnapshot["File: learning_package_snapshot.md"] -.->|Read context| SeekTruth
    end

    subgraph subGraphSynthesize["II. Intelligence Synthesis"]
        direction TB
        Intelligence["AI: Autonomous Synthesis"] --> Synthesis["Action: Record ADRs/Learnings"]
    end

    subgraph subGraphStrategic["III. Strategic Review (Gate 1)"]
        direction TB
        GovApproval{"Strategic Approval<br>(HITL)"}
    end

    subgraph subGraphAudit["IV. Red Team Audit (Gate 2)"]
        direction TB
        CaptureAudit["MCP: cortex_capture_snapshot<br>(audit | learning_audit)"]
        Packet["Audit Packet (Snapshot)"]
        TechApproval{"Technical Approval<br>(HITL)"}
    end

    subgraph subGraphSeal["V. The Technical Seal"]
        direction TB
        CaptureSeal["MCP: cortex_capture_snapshot (seal)"]
    end

    SeekTruth -- "Carry context" --> Intelligence
    Synthesis -- "Verify reasoning" --> GovApproval
    
    GovApproval -- "PASS" --> CaptureAudit
    CaptureAudit -- "Validate truth" --> Packet
    Packet -- "Technical review" --> TechApproval
    
    TechApproval -- "PASS" --> CaptureSeal
    CaptureSeal -- "Final Relay" --> SuccessorSnapshot
    
    GovApproval -- "FAIL: Backtrack" --> SOP["SOP: recursive_learning.md"]
    TechApproval -- "FAIL: Backtrack" --> SOP
    SOP -- "Loop Back" --> Start

    style TechApproval fill:#ffcccc,stroke:#333,stroke-width:2px,color:black
    style GovApproval fill:#ffcccc,stroke:#333,stroke-width:2px,color:black
    style CaptureAudit fill:#bbdefb,stroke:#0056b3,stroke-width:2px,color:black
    style CaptureSeal fill:#bbdefb,stroke:#0056b3,stroke-width:2px,color:black
    style SuccessorSnapshot fill:#f9f,stroke:#333,stroke-width:2px,color:black
    style Start fill:#dfd,stroke:#333,stroke-width:2px,color:black
    style Intelligence fill:#000,stroke:#fff,stroke-width:2px,color:#fff
