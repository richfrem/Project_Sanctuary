{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://project-sanctuary.org/schemas/council-round-packet-v1.0.0.json",
  "title": "Council Round Packet",
  "description": "Schema for Council Round Packet - Phase 2 Frozen Contract",
  "type": "object",
  "required": [
    "timestamp",
    "session_id",
    "round_id",
    "member_id",
    "engine",
    "seed",
    "prompt_hash",
    "inputs",
    "decision",
    "rationale",
    "confidence",
    "citations",
    "rag",
    "cag",
    "novelty",
    "memory_directive",
    "cost",
    "errors",
    "schema_version",
    "retrieval",
    "conflict",
    "seed_chain"
  ],
  "properties": {
    "timestamp": {
      "type": "string",
      "description": "ISO 8601 timestamp"
    },
    "session_id": {
      "type": "string",
      "description": "Unique session identifier"
    },
    "round_id": {
      "type": "integer",
      "minimum": 0,
      "description": "Round number within session"
    },
    "member_id": {
      "type": "string",
      "description": "Council member identifier"
    },
    "engine": {
      "type": "string",
      "description": "Engine/model used"
    },
    "seed": {
      "type": "integer",
      "minimum": 0,
      "description": "Random seed for reproducibility"
    },
    "prompt_hash": {
      "type": "string",
      "description": "SHA256 hash of prompt content (first 16 chars)"
    },
    "inputs": {
      "type": "object",
      "description": "Input parameters and context"
    },
    "decision": {
      "type": "string",
      "description": "Council member's decision"
    },
    "rationale": {
      "type": "string",
      "description": "Reasoning behind the decision"
    },
    "confidence": {
      "type": "number",
      "minimum": 0.0,
      "maximum": 1.0,
      "description": "Confidence score (0.0-1.0)"
    },
    "citations": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["doc_id", "text", "start_byte", "end_byte"],
        "properties": {
          "doc_id": {
            "type": "string",
            "description": "Document identifier"
          },
          "text": {
            "type": "string",
            "description": "Cited text snippet"
          },
          "start_byte": {
            "type": "integer",
            "minimum": 0,
            "description": "Start byte position in document"
          },
          "end_byte": {
            "type": "integer",
            "minimum": 0,
            "description": "End byte position in document"
          }
        }
      },
      "description": "Evidence citations with byte ranges"
    },
    "rag": {
      "type": "object",
      "description": "Retrieval-Augmented Generation data"
    },
    "cag": {
      "type": "object",
      "description": "Cache-Augmented Generation data"
    },
    "novelty": {
      "type": "object",
      "required": ["is_novel", "signal", "basis"],
      "properties": {
        "is_novel": {
          "type": "boolean",
          "description": "Whether the response is novel"
        },
        "signal": {
          "type": "string",
          "enum": ["none", "low", "medium", "high"],
          "description": "Novelty signal strength"
        },
        "basis": {
          "type": "object",
          "description": "Metrics and evidence for novelty assessment"
        }
      }
    },
    "memory_directive": {
      "type": "object",
      "required": ["tier", "justification"],
      "properties": {
        "tier": {
          "type": "string",
          "enum": ["fast", "medium", "slow"],
          "description": "Memory tier recommendation"
        },
        "justification": {
          "type": "string",
          "description": "Reason for tier selection"
        }
      }
    },
    "cost": {
      "type": "object",
      "description": "Cost and resource usage metrics"
    },
    "errors": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "Error messages encountered"
    },
    "schema_version": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+\\.\\d+$",
      "description": "Semantic version of schema"
    },
    "retrieval": {
      "type": "object",
      "required": ["structured_query", "parent_docs", "retrieval_latency_ms", "plan_latency_ms", "analyze_latency_ms", "emit_latency_ms"],
      "properties": {
        "structured_query": {
          "type": "object",
          "description": "Structured query for retrieval"
        },
        "parent_docs": {
          "type": "array",
          "items": {
            "type": "object"
          },
          "description": "Retrieved parent documents"
        },
        "retrieval_latency_ms": {
          "type": "integer",
          "minimum": 0,
          "description": "Retrieval latency in milliseconds"
        },
        "plan_latency_ms": {
          "type": "integer",
          "minimum": 0,
          "description": "Planning stage latency in milliseconds"
        },
        "analyze_latency_ms": {
          "type": "integer",
          "minimum": 0,
          "description": "Analysis stage latency in milliseconds"
        },
        "emit_latency_ms": {
          "type": "integer",
          "minimum": 0,
          "description": "Emit stage latency in milliseconds"
        }
      }
    },
    "conflict": {
      "type": "object",
      "required": ["conflicts_with", "basis"],
      "properties": {
        "conflicts_with": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "List of conflicting member IDs or cached answers"
        },
        "basis": {
          "type": "object",
          "description": "Evidence and metrics for conflict detection"
        }
      }
    },
    "seed_chain": {
      "type": "object",
      "description": "Provenance chain for deterministic replay"
    }
  },
  "additionalProperties": false
}