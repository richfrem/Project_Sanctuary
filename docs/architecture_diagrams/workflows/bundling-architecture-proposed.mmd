---
config:
  theme: base
---
flowchart TB
    START["1. Workflow: workflow-bundle"] --> INIT["2. manifest_manager.py init --type TYPE"]
    INIT -.- NOTE_TYPES["Types from base-manifests-index.json: generic, context-bundler, learning_audit, red_team, etc."]
    INIT --> BASE_LOADED["Base manifest loaded"]
    BASE_LOADED --> BUNDLE["3. bundle.py manifest.json -o output.md"]
    BUNDLE --> OUTPUT["Output: temp/context-bundles/*.md"]
    OUTPUT --> LLM_ACTIVITY["4. LLM Activity"]
    LLM_ACTIVITY --> LLM_WORK["Research / Red Team / Analysis"]
    LLM_WORK --> MODIFY_CHECK{"Modify manifest?"}
    MODIFY_CHECK -- Add --> ADD_FILE["manifest_manager.py add --path file.md --section topic"]
    MODIFY_CHECK -- Remove --> REMOVE_FILE["manifest_manager.py remove --path file.md"]
    ADD_FILE --> REBUNDLE["manifest_manager.py bundle"]
    REMOVE_FILE --> REBUNDLE
    REBUNDLE -->|"<b>Recursion</b>: progressive<br/>elaboration based on<br/>additional research or<br/>redteam analysis"| OUTPUT
    MODIFY_CHECK -- Complete --> SEAL["Workflow: workflow-seal"]
    SEAL --> PERSIST["Workflow: workflow-persist"]
    PERSIST --> END["cortex_cli.py persist-soul"]

     START:::phase
     INIT:::action
     BASE_LOADED:::file
     BUNDLE:::phase
     OUTPUT:::file
     LLM_ACTIVITY:::phase
     LLM_WORK:::loop
     MODIFY_CHECK:::decision
     ADD_FILE:::loop
     REMOVE_FILE:::loop
     REBUNDLE:::loop
     SEAL:::phase
     PERSIST:::phase
     END:::action
    classDef phase fill:#e3f2fd,stroke:#1565c0,color:#000,stroke-width:2px
    classDef decision fill:#fff9c4,stroke:#f9a825,color:#000,stroke-width:2px
    classDef action fill:#c8e6c9,stroke:#2e7d32,color:#000,stroke-width:2px
    classDef loop fill:#f3e5f5,stroke:#7b1fa2,color:#000,stroke-width:2px
    classDef file fill:#fff3e0,stroke:#e65100,color:#000,stroke-width:1px