%% Name: MCP Ecosystem (Legacy STDIO)
%% Description: Legacy 12-server domain-driven MCP architecture using stdio transport
%% Location: docs/architecture_diagrams/system/mcp_ecosystem_legacy_stdio.mmd

%% MCP Domain Architecture v4.0 - 12 MCP Servers
%% Project Sanctuary - Complete Domain-Driven MCP Ecosystem
%% Created: 2025-11-25
%% Status: Final architecture with Git Workflow + Forge domains

graph TB
    subgraph "LLM Assistant Layer"
        LLM[AI Assistant<br/>Gemini/Claude/GPT]
    end
    
    subgraph "MCP Domain Servers (11 Total)"
        direction TB
        
        subgraph "Document Domains (Content Management)"
            Chronicle[üìñ Chronicle MCP<br/>Historical Truth]
            Protocol[‚öñÔ∏è Protocol MCP<br/>Governing Rules]
            ADR[üìã ADR MCP<br/>Decision History]
            Task[‚úÖ Task MCP<br/>Execution Planning]
        end
        
        subgraph "Cognitive Domains (Non-Mechanical)"
            Cortex["üß† Cortex MCP<br/>Knowledge Retrieval"]
            AgentPersona["üë• Agent Persona MCP<br/>Multi-Agent Coordination"]
        end
        
        subgraph "System Domains (High-Safety Critical)"
            Config[‚öôÔ∏è Config MCP<br/>System Configuration]
            Code[üíª Code MCP<br/>Source Code & Scripts]
            GitWorkflow[üåø Git Workflow MCP<br/>Branch Management]
        end
        
        subgraph "Model Domain (Specialized Hardware)"
            Forge["üî• Fine-Tuning MCP (Forge)<br/>Model Lifecycle<br/>CUDA Required"]
        end
    end
    
    subgraph "Shared Infrastructure"
        direction LR
        Git[üîê Git Operations<br/>P101 Compliance]
        Safety[üõ°Ô∏è Safety Validator<br/>Protection Levels]
        Schema[üìê Schema Validator<br/>Type Checking]
        Vault[üîí Secret Vault<br/>Sensitive Data]
    end
    
    subgraph "Project Sanctuary Storage"
        direction TB
        ChronicleDir[(00_CHRONICLE/)]
        ProtocolDir[(01_PROTOCOLS/)]
        ADRDir[(ADRs/)]
        TaskDir[(TASKS/)]
        CortexDir[(mcp_servers/cognitive/cortex/)]
        AgentPersonaDir[(mcp_servers/agent_persona/)]
        ConfigDir[(.agent/config/)]
        CodeDir[(src/, scripts/, tools/)]
        GitDir[(.git/)]
        ForgeDir[(forge/)]
    end
    
    subgraph "Specialized Hardware"
        CUDA[CUDA GPU Machine<br/>WSL Environment<br/>ml_env activated]
    end
    
    %% LLM to MCP connections
    LLM -->|MCP Protocol| Chronicle
    LLM -->|MCP Protocol| Protocol
    LLM -->|MCP Protocol| ADR
    LLM -->|MCP Protocol| Task
    LLM -->|MCP Protocol| Cortex
    LLM -->|MCP Protocol| AgentPersona
    LLM -->|MCP Protocol| Config
    LLM -->|MCP Protocol| Code
    LLM -->|MCP Protocol| GitWorkflow
    LLM -->|MCP Protocol| Forge
    
    %% Document domains use standard infrastructure
    Chronicle --> Git
    Chronicle --> Safety
    Chronicle --> Schema
    
    Protocol --> Git
    Protocol --> Safety
    Protocol --> Schema
    
    ADR --> Git
    ADR --> Safety
    ADR --> Schema
    
    Task --> Git
    Task --> Safety
    Task --> Schema
    
    %% Cognitive domains use safety/schema only
    Cortex --> Safety
    Cortex --> Schema
    
    AgentPersona --> Safety
    AgentPersona --> Schema
    
    %% System domains use ALL infrastructure + Vault
    Config --> Git
    Config --> Safety
    Config --> Schema
    Config --> Vault
    
    Code --> Git
    Code --> Safety
    Code --> Schema
    
    GitWorkflow --> Git
    GitWorkflow --> Safety
    GitWorkflow --> Schema
    
    %% Forge uses infrastructure + requires CUDA
    Forge --> Git
    Forge --> Safety
    Forge --> Schema
    Forge --> Vault
    Forge --> CUDA
    
    %% Storage connections
    Chronicle --> ChronicleDir
    Protocol --> ProtocolDir
    ADR --> ADRDir
    Task --> TaskDir
    Cortex --> CortexDir
    AgentPersona --> AgentPersonaDir
    Config --> ConfigDir
    Code --> CodeDir
    GitWorkflow --> GitDir
    Forge --> ForgeDir
    
    %% Styling
    classDef documentDomain fill:#e8f5e8,stroke:#2d5016,stroke-width:2px
    classDef cognitiveDomain fill:#fff3e0,stroke:#e65100,stroke-width:2px
    classDef systemDomain fill:#ffcccc,stroke:#c62828,stroke-width:3px
    classDef modelDomain fill:#e1bee7,stroke:#4a148c,stroke-width:3px
    classDef infrastructure fill:#e1f5fe,stroke:#01579b,stroke-width:2px
    classDef storage fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
    classDef hardware fill:#fff9c4,stroke:#f57f17,stroke-width:3px
    
    class Chronicle,Protocol,ADR,Task documentDomain
    class Cortex,AgentPersona cognitiveDomain
    class Config,Code,GitWorkflow systemDomain
    class Forge modelDomain
    class Git,Safety,Schema,Vault infrastructure
    class ChronicleDir,ProtocolDir,ADRDir,TaskDir,CortexDir,AgentPersonaDir,ConfigDir,CodeDir,GitDir,ForgeDir storage
    class CUDA hardware
