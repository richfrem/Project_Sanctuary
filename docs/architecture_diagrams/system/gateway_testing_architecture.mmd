---
config:
  theme: base
  layout: elk
---

%% Name: Gateway Testing Architecture
%% Description: Test infrastructure setup for MCP gateway verification
%% Location: docs/architecture_diagrams/system/gateway_testing_architecture.mmd

flowchart LR
    subgraph Local["üñ•Ô∏è Local Host"]
        direction TB
        subgraph TestSuites["üìä Testing Hierarchy"]
            Unit{{"Tier 1: Unit Tests"}}
            Int{{"Tier 2: Integration Tests"}}
            E2E{{"Tier 3: E2E Tests"}}
        end
        Client["LLM Chat / Developer IDE"]
        Bridge["MCP Gateway Bridge<br/>mcp_servers/gateway/bridge.py"]
        
        subgraph LocalDev["üîß Local Dev Mode"]
            LocalServer["python -m server<br/>(MCP_TRANSPORT=stdio)"]
            StdioWrap["FastMCP Wrapper<br/>fastmcp library"]
        end
    end

    subgraph Containers["üê≥ Podman Network"]
        direction LR
        Gateway["sanctuary_gateway<br/>IBM MCP Cortex Gateway Clone<br/>localhost:4444"]
        
        subgraph Cluster["üì¶ MCP Cluster Container<br/>(MCP_TRANSPORT=sse)"]
            direction TB
            SSEWrap["SSEServer Wrapper<br/>lib/sse_adaptor.py"]
            Logic["üß† operations.py<br/>(Shared Logic Layer)"]
        end
    end
    Unit -. "Import & Mock" .-> Logic
    Int -. "Local Stdio<br/>‚è≥ Not Implemented" .-> LocalServer
    Int -- "HTTP/SSE :8100-8105<br/>‚úÖ Health ‚úÖ Tools" --> SSEWrap
    E2E -- "Simulates Stdio" --> Bridge
    Client -- "Stdio" --> Bridge
    Bridge -- "HTTPS (Auth + SSL)" --> Gateway
    Gateway -- "SSE Handshake" --> SSEWrap
    LocalServer --> StdioWrap
    StdioWrap --> Logic
    SSEWrap --> Logic
    style Bridge fill:#f9f,stroke:#333
    style Gateway fill:#69f,stroke:#333
    style LocalDev fill:#e3f2fd,stroke:#1565c0,stroke-width:2px
    style TestSuites fill:#fff3e0,stroke:#e65100,stroke-width:2px
    style Unit fill:#e1f5fe,stroke:#01579b
    style Int fill:#fff9c4,stroke:#fbc02d
    style E2E fill:#ffebee,stroke:#c62828
    style Cluster fill:#eceff1,stroke:#455a64,stroke-width:2px
