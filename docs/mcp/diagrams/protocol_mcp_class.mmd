%% Protocol MCP Server - Class Diagram
%% Shows all operations with version management
%% Created: 2025-11-25

classDiagram
    class project_sanctuary_document_protocol {
        +create_protocol(number, title, classification, content, status?, version?, linked_protocols?) FileOperationResult
        +update_protocol(number, updates, changelog, new_version) FileOperationResult
        +get_protocol(number) Protocol
        +list_protocols(classification?, status?) QueryResult~Protocol~
        +search_protocols(query) QueryResult~Protocol~
        +archive_protocol(number, reason) FileOperationResult
        -validate_protocol_schema(protocol, is_update, current_version?) ValidationResult
        -enforce_version_bump(current_version, new_version, status) boolean
        -generate_protocol_markdown(protocol) string
    }
    
    class Protocol {
        +number number
        +string title
        +string classification
        +string content
        +string status
        +string version
        +number[] linked_protocols
    }
    
    class SafetyValidator {
        +validate_path(path) ValidationResult
        +get_protection_level(path) ProtectionLevel
        +is_protected_file(path) boolean
    }
    
    class SchemaValidator {
        +validate_protocol(protocol, is_update?, current_version?) ValidationResult
    }
    
    class GitOperations {
        +commit_with_manifest(files, message, push?) CommitResult
    }
    
    project_sanctuary_document_protocol --> Protocol : manages
    project_sanctuary_document_protocol --> SafetyValidator : validates with
    project_sanctuary_document_protocol --> SchemaValidator : validates with
    project_sanctuary_document_protocol --> GitOperations : commits via
    
    note for project_sanctuary_document_protocol "Safety Rules:\n- Protocol numbers must be unique\n- Cannot delete (archive only)\n- Updates to CANONICAL require\n  version bump (enforced)\n- Protected protocols need approval"
    
    note for SchemaValidator "Enforces:\n- new_version > current_version\n- version required if status=CANONICAL"
