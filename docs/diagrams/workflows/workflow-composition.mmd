graph TD
    %% Styling
    classDef meta fill:#d4e1f5,stroke:#2b5797,stroke-width:2px,color:#000
    classDef domain fill:#e3f2fd,stroke:#0288d1,stroke-width:2px,color:#000
    classDef atomic fill:#e8f5e9,stroke:#388e3c,stroke-width:2px,color:#000
    classDef output fill:#fff9c4,stroke:#fbc02d,stroke-width:2px,stroke-dasharray: 5 5,color:#000

    subgraph Tier3 ["Tier 3: Meta-Orchestrators (Lifecycle)"]
        P128["/sanctuary-learning-loop<br/>(Protocol 128)"]:::meta
        SpecKit["/spec-kitty.*<br/>(Specification)"]:::meta
    end

    subgraph Tier2 ["Tier 2: Domain Management"]
        Chronicle["/sanctuary-chronicle<br/>(Journaling)"]:::domain
        Task["/tasks-manage<br/>(Kanban)"]:::domain
        ADR["/adr-manage<br/>(Architecture)"]:::domain
    end

    subgraph Tier1 ["Tier 1: Atomic Phases (Protocol Ops)"]
        Start["/sanctuary-start"]:::atomic
        Scout["/sanctuary-scout"]:::atomic
        Audit["/sanctuary-audit"]:::atomic
        Seal["/sanctuary-seal"]:::atomic
        Persist["/sanctuary-persist"]:::atomic
        End["/sanctuary-end"]:::atomic
        Sync["/codify-intelligence-sync"]:::atomic
    end

    subgraph Outputs ["Outputs"]
        Doc["Learning Snapshot (MD)"]:::output
        Cache["RLM Cache (JSON)"]:::output
        Soul["Soul Traces (HuggingFace)"]:::output
    end

    %% Protocol 128 Composition
    P128 -->|1. Initialize| Start
    P128 -->|2. Scout| Scout
    P128 -->|3. Define| SpecKit
    
    %% Execution Phase uses Domain Tools
    P128 -.->|Executive| Chronicle
    P128 -.->|Executive| Task
    P128 -.->|Executive| ADR
    
    %% Closure Phase
    P128 -->|4. Audit| Audit
    P128 -->|5. Seal| Seal
    P128 -->|6. Persist| Persist
    P128 -->|7. Close| End
    
    %% Output Generation
    Scout --> Doc
    Seal --> Doc
    Persist --> Soul
    Sync --> Cache
    P128 --> Sync

    %% Links
    click P128 "https://github.com/richfrem/Project_Sanctuary/blob/main/.agent/workflows/sanctuary_protocols/sanctuary-learning-loop.md" "View Workflow"
    click Scout "https://github.com/richfrem/Project_Sanctuary/blob/main/.agent/workflows/sanctuary_protocols/sanctuary-scout.md" "View Workflow"
    click Audit "https://github.com/richfrem/Project_Sanctuary/blob/main/.agent/workflows/sanctuary_protocols/sanctuary-audit.md" "View Workflow"
    click Seal "https://github.com/richfrem/Project_Sanctuary/blob/main/.agent/workflows/sanctuary_protocols/sanctuary-seal.md" "View Workflow"
    click Persist "https://github.com/richfrem/Project_Sanctuary/blob/main/.agent/workflows/sanctuary_protocols/sanctuary-persist.md" "View Workflow"
