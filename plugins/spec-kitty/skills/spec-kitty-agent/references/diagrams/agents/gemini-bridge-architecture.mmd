graph TD
    %% Phase 1: Sources
    subgraph Phase1 ["Phase 1: Sources of Truth"]
        P_Rules[".agent/rules/ (Constitution, Policy)"]
        W_Masters[".windsurf/workflows/ (Masters)"]
        Plugins["plugins/*/commands/ (Capabilities)"]
    end

    %% Phase 2: Bridge Logic
    subgraph Phase2 ["Phase 2: Universal Sync"]
        BridgeSync["speckit_system_bridge.py<br/>(Rule Projection)"]
        BridgeInstall["/plugin-manager_install<br/>(Command Transformation)"]
    end

    %% Phase 3: Gemini Target
    subgraph Phase3 ["Phase 3: Gemini CLI Environment"]
        GeminiMD["GEMINI.md<br/>(Project Context)"]
        GeminiCmds[".gemini/commands/*.toml<br/>(TOML Wrapped Prompts)"]
    end

    %% Connections
    P_Rules --> BridgeSync
    W_Masters --> BridgeSync
    Plugins --> BridgeInstall

    %% Logic Flow
    BridgeSync -->|"Headers (Concatenated)"| GeminiMD
    BridgeInstall -->|"TOML Wrap & Actor Swap"| GeminiCmds
    
    %% Shared Link
    GeminiMD --- GeminiCmds
