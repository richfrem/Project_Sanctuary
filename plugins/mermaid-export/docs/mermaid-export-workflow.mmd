sequenceDiagram
    participant User as User / Agent
    participant Script as export_mmd_to_image.py
    participant FS as File System
    participant NPX as npx @mermaid-js/mermaid-cli

    Note over User, NPX: Option A: Check Mode (--check)

    User->>Script: /mermaid-export:check -i docs/diagrams/
    Script->>FS: Scan for *.mmd files (recursive)
    loop For each .mmd file
        Script->>FS: Compare mtime: .mmd vs .png
        alt Image missing or older than source
            Script-->>User: âš ï¸ diagram.mmd needs rendering
        end
    end
    Script-->>User: N diagrams need rendering

    Note over User, NPX: Option B: Render Mode

    User->>Script: /mermaid-export:render -i diagram.mmd
    Script->>Script: Resolve input/output paths
    Script->>NPX: Check mermaid-cli availability
    NPX-->>Script: âœ… Version info

    loop For each .mmd file
        Script->>NPX: mmdc -i diagram.mmd -o diagram.png -b transparent
        NPX->>FS: Write PNG/SVG image
        NPX-->>Script: Exit code 0
        Script-->>User: âœ… diagram.mmd â†’ diagram.png
    end

    Script-->>User: ğŸ“Š Rendered N, Failed M
