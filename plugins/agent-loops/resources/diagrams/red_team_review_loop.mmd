---
config:
  theme: base
---

%% Pattern 2: Red Team Review Loop
%% Orchestrated research with iterative adversarial review rounds.
%% Location: resources/diagrams/red_team_review_loop.mmd

flowchart TB
    Start(["Trigger:<br>Architecture / Design / Problem to Review"])
    Start --> Orient["Load Prior Context"]
    
    subgraph Execution["Review Packet Generation"]
        Research["Deep-Dive Research & Analysis"]
        Prompt["Create/Update Review Prompt<br>(Define Red Team Context)"]
        Manifest["Update File Manifest<br>(Select Context Files)"]
        Bundler{{"context-bundler<br>Plugin"}}
        
        Orient --> Research
        Research --> Prompt
        Prompt --> Manifest
        Manifest -->|Assemble Packet| Bundler
    end
    
    Bundler --> Dispatch["Dispatch to Red Team<br>(Browser Agents / CLI Agents / Human)"]

    Dispatch --> Review{"Red Team Verdict"}
    Review -- "More Research Needed" --> Feedback["Capture Feedback"]
    Feedback --> Research
    Review -- "Approved" --> Synthesize["Synthesize Approved Findings"]

    Synthesize --> Handoff["Completion & Handoff<br>to Orchestrator"]
    Handoff -.->|Orchestrator| Next["Retrospective & Closure"]
    Next -.->|"Next Round / Session"| Start

    style Start fill:#dfd,stroke:#333,stroke-width:2px
    style Review fill:#fce4ec,stroke:#880e4f,stroke-width:2px
    style Dispatch fill:#fce4ec,stroke:#880e4f,stroke-width:2px
    style Handoff fill:#d4edda,stroke:#155724,stroke-width:2px
    style Next fill:#f5f5f5,stroke:#9e9e9e,stroke-width:1px,stroke-dasharray: 5 5
    style Bundler fill:#81c784,stroke:#2e7d32,stroke-width:2px,stroke-dasharray: 5 5
