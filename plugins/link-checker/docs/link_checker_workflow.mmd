---
config:
  layout: dagre
  theme: base
---

%% Name: Link Checker Workflow
%% Description: Sequence for validating and repairing broken documentation links
%% Location: docs/architecture_diagrams/workflows/link_checker_workflow.mmd

flowchart TB
    subgraph Detection["Phase 1: Detection"]
        direction TB
        Start["Start Link Validation"] --> Choice{Which Method?}
        
        Choice -- "Comprehensive<br/>(Recommended)" --> VerifyLinks["verify_links.py<br/>(Manifests + Markdown)"]
        Choice -- "Quick Check" --> CheckBroken["check_broken_paths.py<br/>(Markdown Only)"]
        
        VerifyLinks --> Report1["Output: invalid_links_report.json"]
        CheckBroken --> Report2["Output: broken_links.log"]
    end
    
    subgraph Repair["Phase 2: Auto-Repair"]
        direction TB
        MapFiles["map_repository_files.py"] --> Inventory["Output: file_inventory.json"]
        Inventory --> DryRun["smart_fix_links.py --dry-run"]
        DryRun --> Review{Review Changes?}
        Review -- "Approve" --> Fix["smart_fix_links.py"]
        Review -- "Reject" --> Manual["Manual Fixes Required"]
        Fix --> Fixed["Links Repaired"]
    end
    
    subgraph Verify["Phase 3: Verification"]
        direction TB
        ReCheck["Re-run verify_links.py"] --> Clean{Clean Report?}
        Clean -- "Yes" --> Success["âœ… Documentation Healthy"]
        Clean -- "No" --> Manual2["More Manual Fixes Needed"]
    end
    
    %% Flow connections
    Report1 --> HasIssues{Issues Found?}
    Report2 --> HasIssues
    
    HasIssues -- "Yes" --> MapFiles
    HasIssues -- "No" --> Success
    
    Fixed --> ReCheck
    Manual --> ReCheck
    Manual2 --> MapFiles

    %% Styles
    style Start fill:#dfd,stroke:#333,stroke-width:2px
    style Success fill:#dfd,stroke:#333,stroke-width:2px
    style VerifyLinks fill:#cce5ff,stroke:#004085,stroke-width:2px
    style Fix fill:#fff3cd,stroke:#856404,stroke-width:2px
    
    %% Metadata
    %% Last Updated: 2026-01-11
