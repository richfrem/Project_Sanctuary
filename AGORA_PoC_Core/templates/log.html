<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AGORA Glass Box Log - Radical Transparency</title>
    <style>
        /* DOCTRINE_LINK: WI_002_Glass_Box_Principle */
        /* Visual design embodies complete transparency and operational visibility */
        body {
            font-family: 'Courier New', monospace;
            background-color: #0a0a0a;
            color: #00ff41;
            margin: 0;
            padding: 20px;
            line-height: 1.4;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: #000;
            padding: 30px;
            border: 2px solid #00ff41;
            border-radius: 8px;
        }
        h1 {
            text-align: center;
            color: #00ff41;
            margin-bottom: 10px;
            font-size: 2em;
        }
        .subtitle {
            text-align: center;
            color: #888;
            margin-bottom: 30px;
            font-style: italic;
        }
        .doctrine-note {
            background-color: #1a3a1a;
            border-left: 4px solid #00ff41;
            padding: 20px;
            margin: 20px 0;
            font-size: 0.95em;
        }
        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 20px 0;
            padding: 15px;
            background-color: #0f0f0f;
            border: 1px solid #333;
            border-radius: 4px;
        }
        .auto-refresh {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .auto-refresh input[type="checkbox"] {
            transform: scale(1.2);
        }
        .log-container {
            background-color: #000;
            border: 2px solid #00ff41;
            border-radius: 4px;
            padding: 20px;
            max-height: 600px;
            overflow-y: auto;
            font-size: 0.9em;
        }
        .log-entry {
            margin: 10px 0;
            padding: 12px;
            border-left: 4px solid #00ff41;
            background-color: #0a0a0a;
        }
        .log-entry.INFO {
            border-left-color: #00ff41;
            background-color: #0a1a0a;
        }
        .log-entry.WARN {
            border-left-color: #ffaa00;
            background-color: #1a1a0a;
            color: #ffcc66;
        }
        .log-entry.ERROR {
            border-left-color: #ff4444;
            background-color: #1a0a0a;
            color: #ff6666;
        }
        .log-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            font-weight: bold;
        }
        .log-level {
            padding: 2px 8px;
            border-radius: 3px;
            font-size: 0.8em;
            font-weight: bold;
        }
        .log-level.INFO {
            background-color: #00ff41;
            color: #000;
        }
        .log-level.WARN {
            background-color: #ffaa00;
            color: #000;
        }
        .log-level.ERROR {
            background-color: #ff4444;
            color: #fff;
        }
        .log-timestamp {
            color: #888;
            font-size: 0.8em;
        }
        .log-message {
            margin: 8px 0;
            font-weight: bold;
        }
        .log-context {
            background-color: #111;
            border: 1px solid #333;
            border-radius: 3px;
            padding: 10px;
            margin-top: 8px;
            font-size: 0.85em;
            color: #ccc;
        }
        .log-context pre {
            margin: 0;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        .no-logs {
            text-align: center;
            color: #888;
            font-style: italic;
            margin: 40px 0;
        }
        .refresh-button {
            background-color: #00ff41;
            color: #000;
            border: none;
            padding: 8px 16px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            border-radius: 4px;
            transition: background-color 0.3s;
        }
        .refresh-button:hover {
            background-color: #00cc33;
        }
        .stats {
            display: flex;
            gap: 20px;
            font-size: 0.9em;
            color: #888;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>AGORA Glass Box Log</h1>
        <p class="subtitle">Radical Transparency in Action</p>
        
        <div class="doctrine-note">
            <strong>DOCTRINE:</strong> This Glass Box Log embodies the WI_002 Glass Box Principle, 
            providing complete transparency into all AGORA operations. Every action, decision, 
            and system event is logged and made publicly accessible, ensuring accountability 
            and enabling community oversight of the collective intelligence system.
        </div>
        
        <div class="controls">
            <div class="stats">
                <span>Total Logs: <span id="logCount">0</span></span>
                <span>Last Updated: <span id="lastUpdate">Never</span></span>
            </div>
            <div class="auto-refresh">
                <input type="checkbox" id="autoRefresh" checked>
                <label for="autoRefresh">Auto-refresh (5s)</label>
                <button class="refresh-button" onclick="loadLogs()">Refresh Now</button>
            </div>
        </div>
        
        <div class="log-container" id="logContainer">
            <div class="no-logs">Loading Glass Box logs...</div>
        </div>
    </div>

    <script>
        // DOCTRINE_LINK: WI_002_Glass_Box_Principle
        // JavaScript implementation of real-time transparency monitoring
        // enabling continuous public oversight of AGORA operations.
        
        let autoRefreshInterval;
        
        // Load logs on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadLogs();
            setupAutoRefresh();
        });
        
        // Setup auto-refresh functionality
        function setupAutoRefresh() {
            const checkbox = document.getElementById('autoRefresh');
            
            checkbox.addEventListener('change', function() {
                if (this.checked) {
                    startAutoRefresh();
                } else {
                    stopAutoRefresh();
                }
            });
            
            // Start auto-refresh by default
            if (checkbox.checked) {
                startAutoRefresh();
            }
        }
        
        function startAutoRefresh() {
            // Clear any existing interval
            if (autoRefreshInterval) {
                clearInterval(autoRefreshInterval);
            }
            
            // Set up new interval for 5-second refresh
            autoRefreshInterval = setInterval(loadLogs, 5000);
        }
        
        function stopAutoRefresh() {
            if (autoRefreshInterval) {
                clearInterval(autoRefreshInterval);
                autoRefreshInterval = null;
            }
        }
        
        async function loadLogs() {
            try {
                const response = await fetch('/api/glass_box_logs');
                const result = await response.json();
                
                if (result.success) {
                    displayLogs(result.logs);
                    updateStats(result.count);
                } else {
                    document.getElementById('logContainer').innerHTML = 
                        '<div class="no-logs">Error loading logs: ' + result.error + '</div>';
                }
            } catch (error) {
                document.getElementById('logContainer').innerHTML = 
                    '<div class="no-logs">Network error loading logs: ' + error.message + '</div>';
            }
        }
        
        function displayLogs(logs) {
            const container = document.getElementById('logContainer');
            
            if (logs.length === 0) {
                container.innerHTML = '<div class="no-logs">No logs yet. AGORA operations will appear here as they occur.</div>';
                return;
            }
            
            let html = '';
            logs.forEach(log => {
                html += `
                    <div class="log-entry ${log.level}">
                        <div class="log-header">
                            <span class="log-level ${log.level}">${log.level}</span>
                            <span class="log-timestamp">${formatTimestamp(log.timestamp)}</span>
                        </div>
                        <div class="log-message">${escapeHtml(log.message)}</div>
                        ${log.context && Object.keys(log.context).length > 0 ? 
                            `<div class="log-context">
                                <strong>Context:</strong>
                                <pre>${JSON.stringify(log.context, null, 2)}</pre>
                            </div>` : ''}
                    </div>
                `;
            });
            
            container.innerHTML = html;
            
            // Auto-scroll to top to show newest entries
            container.scrollTop = 0;
        }
        
        function updateStats(count) {
            document.getElementById('logCount').textContent = count;
            document.getElementById('lastUpdate').textContent = new Date().toLocaleString();
        }
        
        function formatTimestamp(timestamp) {
            const date = new Date(timestamp);
            return date.toLocaleString();
        }
        
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // Cleanup interval on page unload
        window.addEventListener('beforeunload', function() {
            if (autoRefreshInterval) {
                clearInterval(autoRefreshInterval);
            }
        });
    </script>
</body>
</html>
