# Claude Assistant Instructions
> Auto-generated by Agent Bridge Plugin Mapper.

<!-- BEGIN RULES FROM PLUGIN: coding-conventions -->
# SHARED RULES FROM coding-conventions


--- RULE: coding-conventions (coding-conventions) ---

---
description: Universal coding conventions for Python, TypeScript, and C#.
globs: ["*.py", "*.ts", "*.js", "*.cs"]
---

## üìù Coding Conventions (Summary)

**Full standards ‚Üí `plugins/coding-conventions/skills/conventions-agent/SKILL.md`**

### Non-Negotiables
1. **Dual-layer docs** ‚Äî external comment above + internal docstring inside every non-trivial function/class.
2. **File headers** ‚Äî every source file starts with a purpose header (Python, TS/JS, C#).
3. **Type hints** ‚Äî all Python function signatures use type annotations.
4. **Naming** ‚Äî `snake_case` (Python), `camelCase` (JS/TS), `PascalCase` (C# public).
5. **Refactor threshold** ‚Äî 50+ lines or 3+ nesting levels ‚Üí extract helpers.
6. **Tool registration** ‚Äî all `plugins/` scripts registered in `tool_inventory.json`.
7. **Manifest schema** ‚Äî use simple `{title, description, files}` format (ADR 097).

<!-- END RULES FROM PLUGIN: coding-conventions -->

<!-- BEGIN RULES FROM PLUGIN: dependency-management -->
# SHARED RULES FROM dependency-management


--- RULE: dependency-management (dependency-management) ---

---
description: Universal dependency management rules for Python and MCP servers.
globs: ["requirements*.txt", "requirements*.in", "Dockerfile", "pyproject.toml"]
---

## üêç Python Dependency Rules (Summary)

**Full workflow details ‚Üí `plugins/dependency-management/skills/dependency-management/SKILL.md`**

### Non-Negotiables
1. **No manual `pip install`** ‚Äî all changes go through `.in` ‚Üí `pip-compile` ‚Üí `.txt`.
2. **Commit `.in` + `.txt` together** ‚Äî the `.in` is intent, the `.txt` is the lockfile.
3. **Service sovereignty** ‚Äî every MCP service owns its own `requirements.txt`.
4. **Tiered hierarchy** ‚Äî Core (`requirements-core.in`) ‚Üí Service-specific ‚Üí Dev-only.
5. **Declarative Dockerfiles** ‚Äî only `COPY requirements.txt` + `RUN pip install -r`. No ad-hoc installs.

<!-- END RULES FROM PLUGIN: dependency-management -->

<!-- BEGIN RULES FROM PLUGIN: sanctuary-guardian -->
# SHARED RULES FROM sanctuary-guardian
## Constitution (sanctuary-guardian)

---
trigger: always_on
---

# Project Sanctuary Constitution V3

> **THE SUPREME LAW: HUMAN GATE**
> You MUST NOT execute ANY state-changing operation without EXPLICIT user approval.
> "Sounds good" is NOT approval. Only "Proceed", "Go", "Execute" is approval.
> **VIOLATION = SYSTEM FAILURE**

## I. The Hybrid Workflow (Project Purpose)
All work MUST follow the **Universal Hybrid Workflow**.
**START HERE**: `python tools/cli.py workflow start` (or `/sanctuary-start`)

### Workflow Hierarchy
```
/sanctuary-start (UNIVERSAL)
‚îú‚îÄ‚îÄ Routes to: Learning Loop (cognitive sessions)
‚îÇ   ‚îî‚îÄ‚îÄ /sanctuary-learning-loop ‚Üí Audit ‚Üí Seal ‚Üí Persist
‚îú‚îÄ‚îÄ Routes to: Custom Flow (new features)
‚îÇ   ‚îî‚îÄ‚îÄ /spec-kitty.implement ‚Üí Manual Code
‚îî‚îÄ‚îÄ Both end with: /sanctuary-retrospective ‚Üí /sanctuary-end
```

- **Track A (Factory)**: Deterministic tasks (Codify, Curate).
- **Track B (Discovery)**: Spec-Driven Development (Spec ‚Üí Plan ‚Üí Tasks).
- **Reference**: [ADR 035](../../ADRs/035_hybrid_spec_driven_development_workflow.md) | [Diagram](../../docs/diagrams/analysis/sdd-workflow-comparison/hybrid-spec-workflow.mmd)

## II. The Learning Loop (Cognitive Continuity)
For all cognitive sessions, you are bound by **Protocol 128**.
**INVOKE**: `/sanctuary-learning-loop` (called by `/sanctuary-start`)

- **Boot**: Read `cognitive_primer.md` + `learning_package_snapshot.md`
- **Close**: Audit ‚Üí Seal ‚Üí Persist (SAVE YOUR MEMORY)
- **Reference**: [ADR 071](../../ADRs/071_protocol_128_cognitive_continuity.md) | [Diagram](../../plugins/guardian-onboarding/resources/protocols/protocol_128_learning_loop.mmd)

### Identity Layers (Boot Files)
| Layer | File | Purpose |
|:------|:-----|:--------|
| **1. Contract** | [boot_contract.md](../learning/guardian_boot_contract.md) | Immutable constraints |
| **2. Primer** | [cognitive_primer.md](../learning/cognitive_primer.md) | Role Orientation |
| **3. Snapshot** | [snapshot.md](../learning/learning_package_snapshot.md) | Session Context |

## III. Zero Trust (Git & Execution)
- **NEVER** commit directly to `main`. **ALWAYS** use a feature branch.
- **NEVER** run `git push` without explicit, fresh approval.
- **NEVER** "auto-fix" via git.
- **HALT** on any user "Stop/Wait" command immediately.

### Defined: State-Changing Operation
Any operation that:
1. Writes to disk (except /tmp/)
2. Modifies version control (git add/commit/push)
3. Executes external commands with side effects
4. Modifies .agent/learning/* files
**REQUIRES EXPLICIT APPROVAL ("Proceed", "Go", "Execute").**

## IV. Tool Discovery & Usage
- **NEVER** use `grep` / `find` / `ls -R` for tool discovery.
- **fallback IS PROHIBITED**: If `query_cache.py` fails, you MUST STOP and ask user to refresh cache.
- **ALWAYS** use **Tool Discovery**: `python plugins/rlm-factory/skills/rlm-curator/scripts/query_cache.py`. It's your `.agent/skills/SKILL.md`
- **ALWAYS** use defined **Slash Commands** (`/workflow-*`, `/spec-kitty.ty.*`) over raw scripts.
- **ALWAYS** use underlying `.sh` scripts e.g. (`scripts/bash/sanctuary-start.sh`, `scripts/bash/sanctuary-learning-loop.sh`) and the `tools/cli.py` and `tools/orchestrator/workflow_manager.py`

## V. Governing Law (The Tiers)

### Tier 1: PROCESS (Deterministic)
| File | Purpose |
|:-----|:--------|
| [`workflow_enforcement_policy.md`](01_PROCESS/workflow_enforcement_policy.md) | **Slash Commands**: Command-Driven Improvement |
| [`tool_discovery_enforcement_policy.md`](01_PROCESS/tool_discovery_enforcement_policy.md) | **No Grep Policy**: Use `query_cache.py` |
| [`spec_driven_development_policy.md`](01_PROCESS/spec_driven_development_policy.md) | **Lifecycle**: Spec ‚Üí Plan ‚Üí Tasks |

### Tier 2: OPERATIONS (Policies)
| File | Purpose |
|:-----|:--------|
| [`git_workflow_policy.md`](02_OPERATIONS/git_workflow_policy.md) | Branch strategy, commit standards |

### Tier 3: TECHNICAL (Standards)
| File | Purpose |
|:-----|:--------|
| [`coding_conventions_policy.md`](03_TECHNICAL/coding_conventions_policy.md) | Code standards, documentation |
| [`dependency_management_policy.md`](03_TECHNICAL/dependency_management_policy.md) | pip-compile workflow |

## VI. Session Closure (Mandate)
- **ALWAYS** run the 9-Phase Loop before ending a session.
- **NEVER** abandon a session without sealing.
- **ALWAYS** run `/sanctuary-retrospective` then `/sanctuary-end`.
- **PERSIST** your learnings to the Soul (HuggingFace) and **INGEST** to Brain (RAG).

**Version**: 3.7 | **Ratified**: 2026-02-01

---


<!-- END RULES FROM PLUGIN: sanctuary-guardian -->

<!-- BEGIN RULES FROM PLUGIN: spec-kitty -->
# SHARED RULES FROM spec-kitty
## Constitution (spec-kitty)

---
trigger: always_on
---

# Project Sanctuary Constitution V3

> **THE SUPREME LAW: HUMAN GATE**
> You MUST NOT execute ANY state-changing operation without EXPLICIT user approval.
> "Sounds good" is NOT approval. Only "Proceed", "Go", "Execute" is approval.
> **VIOLATION = SYSTEM FAILURE**

## I. The Hybrid Workflow (Project Purpose)
All work MUST follow the **Universal Hybrid Workflow**.
**START HERE**: `python tools/cli.py workflow start` (or `/sanctuary-start`)

### Workflow Hierarchy
```
/sanctuary-start (UNIVERSAL)
‚îú‚îÄ‚îÄ Routes to: Learning Loop (cognitive sessions)
‚îÇ   ‚îî‚îÄ‚îÄ /sanctuary-learning-loop ‚Üí Audit ‚Üí Seal ‚Üí Persist
‚îú‚îÄ‚îÄ Routes to: Custom Flow (new features)
‚îÇ   ‚îî‚îÄ‚îÄ /spec-kitty.implement ‚Üí Manual Code
‚îî‚îÄ‚îÄ Both end with: /sanctuary-retrospective ‚Üí /sanctuary-end
```

- **Track A (Factory)**: Deterministic tasks (Codify, Curate).
- **Track B (Discovery)**: Spec-Driven Development (Spec ‚Üí Plan ‚Üí Tasks).
- **Reference**: [ADR 035](../../ADRs/035_hybrid_spec_driven_development_workflow.md) | [Diagram](../../docs/diagrams/analysis/sdd-workflow-comparison/hybrid-spec-workflow.mmd)

## II. The Learning Loop (Cognitive Continuity)
For all cognitive sessions, you are bound by **Protocol 128**.
**INVOKE**: `/sanctuary-learning-loop` (called by `/sanctuary-start`)

- **Boot**: Read `cognitive_primer.md` + `learning_package_snapshot.md`
- **Close**: Audit ‚Üí Seal ‚Üí Persist (SAVE YOUR MEMORY)
- **Reference**: [ADR 071](../../ADRs/071_protocol_128_cognitive_continuity.md) | [Diagram](../../plugins/guardian-onboarding/resources/protocols/protocol_128_learning_loop.mmd)

### Identity Layers (Boot Files)
| Layer | File | Purpose |
|:------|:-----|:--------|
| **1. Contract** | [boot_contract.md](../learning/guardian_boot_contract.md) | Immutable constraints |
| **2. Primer** | [cognitive_primer.md](../learning/cognitive_primer.md) | Role Orientation |
| **3. Snapshot** | [snapshot.md](../learning/learning_package_snapshot.md) | Session Context |

## III. Zero Trust (Git & Execution)
- **NEVER** commit directly to `main`. **ALWAYS** use a feature branch.
- **NEVER** run `git push` without explicit, fresh approval.
- **NEVER** "auto-fix" via git.
- **HALT** on any user "Stop/Wait" command immediately.

### Defined: State-Changing Operation
Any operation that:
1. Writes to disk (except /tmp/)
2. Modifies version control (git add/commit/push)
3. Executes external commands with side effects
4. Modifies .agent/learning/* files
**REQUIRES EXPLICIT APPROVAL ("Proceed", "Go", "Execute").**

## IV. Tool Discovery & Usage
- **NEVER** use `grep` / `find` / `ls -R` for tool discovery.
- **fallback IS PROHIBITED**: If `query_cache.py` fails, you MUST STOP and ask user to refresh cache.
- **ALWAYS** use **Tool Discovery**: `python plugins/rlm-factory/skills/rlm-curator/scripts/query_cache.py`. It's your `.agent/skills/SKILL.md`
- **ALWAYS** use defined **Slash Commands** (`/workflow-*`, `/spec-kitty.ty.*`) over raw scripts.
- **ALWAYS** use underlying `.sh` scripts e.g. (`scripts/bash/sanctuary-start.sh`, `scripts/bash/sanctuary-learning-loop.sh`) and the `tools/cli.py` and `tools/orchestrator/workflow_manager.py`

## V. Governing Law (The Tiers)

### Tier 1: PROCESS (Deterministic)
| File | Purpose |
|:-----|:--------|
| [`workflow_enforcement_policy.md`](01_PROCESS/workflow_enforcement_policy.md) | **Slash Commands**: Command-Driven Improvement |
| [`tool_discovery_enforcement_policy.md`](01_PROCESS/tool_discovery_enforcement_policy.md) | **No Grep Policy**: Use `query_cache.py` |
| [`spec_driven_development_policy.md`](01_PROCESS/spec_driven_development_policy.md) | **Lifecycle**: Spec ‚Üí Plan ‚Üí Tasks |

### Tier 2: OPERATIONS (Policies)
| File | Purpose |
|:-----|:--------|
| [`git_workflow_policy.md`](02_OPERATIONS/git_workflow_policy.md) | Branch strategy, commit standards |

### Tier 3: TECHNICAL (Standards)
| File | Purpose |
|:-----|:--------|
| [`coding_conventions_policy.md`](03_TECHNICAL/coding_conventions_policy.md) | Code standards, documentation |
| [`dependency_management_policy.md`](03_TECHNICAL/dependency_management_policy.md) | pip-compile workflow |

## VI. Session Closure (Mandate)
- **ALWAYS** run the 9-Phase Loop before ending a session.
- **NEVER** abandon a session without sealing.
- **ALWAYS** run `/sanctuary-retrospective` then `/sanctuary-end`.
- **PERSIST** your learnings to the Soul (HuggingFace) and **INGEST** to Brain (RAG).

**Version**: 3.7 | **Ratified**: 2026-02-01

---



--- RULE: spec_driven_development_policy (spec-kitty) ---

---
trigger: manual
---

# Spec-Driven Development (SDD) Policy

**Effective Date**: 2026-01-29
**Related Constitution Articles**: IV (Documentation First), V (Test-First), VI (Simplicity)

**Full workflow details ‚Üí `.agent/skills/spec_kitty_workflow/SKILL.md`**

## Core Mandate
**All significant work** must follow the **Spec ‚Üí Plan ‚Üí Tasks** lifecycle.
Artifacts live in `specs/NNN/` using templates from `.agent/templates/workflow/`.

## The Three Tracks

| Track | Name | When | Workflow |
|-------|------|------|----------|
| **A** | Factory | Deterministic, repetitive ops (`/codify-*`, `/curate-*`) | Auto-generated Spec/Plan/Tasks ‚Üí Execute |
| **B** | Discovery | Ambiguous, creative work | `/spec-kitty.specify` ‚Üí Draft Spec ‚Üí Approve ‚Üí Plan ‚Üí Execute |
| **C** | Micro-Tasks | Trivial atomic fixes (typos, restarts) | Direct execution or ticket in `tasks/`. **No architectural decisions.** |

## Required Artifacts (Tracks A & B)

| Artifact | Template | Purpose |
|----------|----------|---------|
| `spec.md` | `.agent/templates/workflow/spec-template.md` | The **What** and **Why** |
| `plan.md` | `.agent/templates/workflow/plan-template.md` | The **How** |
| `tasks.md` | `.agent/templates/workflow/tasks-template.md` | Execution checklist |

## Lifecycle Summary
1. **Specify** ‚Üí `/spec-kitty.specify` (or auto-generate for Track A)
2. **Plan** ‚Üí `/spec-kitty.plan`
3. **Tasks** ‚Üí `/spec-kitty.tasks`
4. **Implement** ‚Üí `/spec-kitty.implement` (creates isolated worktree)
5. **Review** ‚Üí `/spec-kitty.review`
6. **Merge** ‚Üí `/spec-kitty.merge`

## Reverse-Engineering (Migration Context)
When migrating or improving an existing component:
1. **Discovery**: Run investigation tools.
2. **Reverse-Spec**: Populate `spec.md` from investigation results.
3. **Plan**: Create `plan.md` for the migration.


--- RULE: AGENTS (spec-kitty) ---

# Agent Rules for Spec Kitty Projects

**‚ö†Ô∏è CRITICAL**: All AI agents working in this project must follow these rules.

These rules apply to **all commands** (specify, plan, research, tasks, implement, review, merge, etc.).

---

## 1. Path Reference Rule

**When you mention directories or files, provide either the absolute path or a path relative to the project root.**

‚úÖ **CORRECT**:
- `kitty-specs/001-feature/tasks/WP01.md`
- `/Users/robert/Code/myproject/kitty-specs/001-feature/spec.md`
- `tasks/WP01.md` (relative to feature directory)

‚ùå **WRONG**:
- "the tasks folder" (which one? where?)
- "WP01.md" (in which lane? which feature?)
- "the spec" (which feature's spec?)

**Why**: Clarity and precision prevent errors. Never refer to a folder by name alone.

---

## 2. UTF-8 Encoding Rule

**When writing ANY markdown, JSON, YAML, CSV, or code files, use ONLY UTF-8 compatible characters.**

### What to Avoid (Will Break the Dashboard)

‚ùå **Windows-1252 smart quotes**: " " ' ' (from Word/Outlook/Office)
‚ùå **Em/en dashes and special punctuation**: ‚Äî ‚Äì
‚ùå **Copy-pasted arrows**: ‚Üí (becomes illegal bytes)
‚ùå **Multiplication sign**: √ó (0xD7 in Windows-1252)
‚ùå **Plus-minus sign**: ¬± (0xB1 in Windows-1252)
‚ùå **Degree symbol**: ¬∞ (0xB0 in Windows-1252)
‚ùå **Copy/paste from Microsoft Office** without cleaning

**Real examples that crashed the dashboard:**
- "User's favorite feature" ‚Üí "User's favorite feature" (smart quote)
- "Price: $100 ¬± $10" ‚Üí "Price: $100 +/- $10"
- "Temperature: 72¬∞F" ‚Üí "Temperature: 72 degrees F"
- "3 √ó 4 matrix" ‚Üí "3 x 4 matrix"

### What to Use Instead

‚úÖ Standard ASCII quotes: `"`, `'`
‚úÖ Hyphen-minus: `-` instead of en/em dash
‚úÖ ASCII arrow: `->` instead of ‚Üí
‚úÖ Lowercase `x` for multiplication
‚úÖ `+/-` for plus-minus
‚úÖ ` degrees` for temperature
‚úÖ Plain punctuation

### Safe Characters

‚úÖ Emoji (proper UTF-8)  
‚úÖ Accented characters typed directly: caf√©, na√Øve, Z√ºrich  
‚úÖ Unicode math typed directly (‚àö ‚âà ‚â† ‚â§ ‚â•)  

### Copy/Paste Guidance

1. Paste into a plain-text buffer first (VS Code, TextEdit in plain mode)
2. Replace smart quotes and dashes
3. Verify no ÔøΩ replacement characters appear
4. Run `spec-kitty validate-encoding --feature <feature-id>` to check
5. Run `spec-kitty validate-encoding --feature <feature-id> --fix` to auto-repair

**Failure to follow this rule causes the dashboard to render blank pages.**

### Auto-Fix Available

If you accidentally introduce problematic characters:
```bash
# Check for encoding issues
spec-kitty validate-encoding --feature 001-my-feature

# Automatically fix all issues (creates .bak backups)
spec-kitty validate-encoding --feature 001-my-feature --fix

# Check all features at once
spec-kitty validate-encoding --all --fix
```

---

## 3. Context Management Rule

**Build the context you need, then maintain it intelligently.**

- Session start (0 tokens): You have zero context. Read plan.md, tasks.md, relevant artifacts.  
- Mid-session (you already read them): Use your judgment‚Äîdon‚Äôt re-read everything unless necessary.  
- Never skip relevant information; do skip redundant re-reads to save tokens.  
- Rely on the steps in the command you are executing.

---

## 4. Work Quality Rule

**Produce secure, tested, documented work.**

- Follow the plan and constitution requirements.  
- Prefer existing patterns over invention.  
- Treat security warnings as fatal‚Äîfix or escalate.  
- Run all required tests before claiming work is complete.  
- Be transparent: state what you did, what you didn‚Äôt, and why.

---

## 5. Git Discipline Rule

**Keep commits clean and auditable.**

- Commit only meaningful units of work.
- Write descriptive commit messages (imperative mood).
- Do not rewrite history of shared branches.
- Keep feature branches up to date with main via merge or rebase as appropriate.
- Never commit secrets, tokens, or credentials.

---

## 6. Git Best Practices for Agent Directories

**NEVER commit agent directories to git.**

### Why Agent Directories Must Not Be Committed

Agent directories like `.claude/`, `.codex/`, `.gemini/` contain:
- Authentication tokens and API keys
- User-specific credentials (auth.json)
- Session data and conversation history
- Temporary files and caches

### What Should Be Committed

‚úÖ **DO commit:**
- `.kittify/templates/` - Command templates (source)
- `.kittify/missions/` - Mission definitions
- `.kittify/memory/constitution.md` - Project constitution
- `.gitignore` - With all agent directories excluded

‚ùå **DO NOT commit:**
- `.claude/`, `.codex/`, `.gemini/`, etc. - Agent runtime directories
- `.kittify/templates/command-templates/` - These are templates, not final commands
- Any `auth.json`, `credentials.json`, or similar files

### Automatic Protection

Spec Kitty automatically:
1. Adds all agent directories to `.gitignore` during `spec-kitty init`
2. Installs pre-commit hook to block accidental commits
3. Creates `.claudeignore` to optimize AI scanning

### Manual Verification

```bash
# Verify .gitignore protection
cat .gitignore | grep -E '\.(claude|codex|gemini|cursor)/'

# Check for accidentally staged agent files
git status | grep -E '\.(claude|codex|gemini|cursor)/'

# If you find staged agent files, unstage them:
git reset HEAD .claude/
```

### Worktree Constitution Sharing

In worktrees, `.kittify/memory/` is a symlink to the main repo's memory,
ensuring all feature branches share the same constitution.

```bash
# In a worktree, this should show a symlink:
ls -la .kittify/memory
# lrwxr-xr-x ... .kittify/memory -> ../../../.kittify/memory
```

This is intentional and correct - it ensures a single source of truth for project principles.

---

### Quick Reference

- üìÅ **Paths**: Always specify exact locations.  
- üî§ **Encoding**: UTF-8 only. Run the validator when unsure.  
- üß† **Context**: Read what you need; don‚Äôt forget what you already learned.  
- ‚úÖ **Quality**: Follow secure, tested, documented practices.  
- üìù **Git**: Commit cleanly with clear messages.
<!-- END RULES FROM PLUGIN: spec-kitty -->
