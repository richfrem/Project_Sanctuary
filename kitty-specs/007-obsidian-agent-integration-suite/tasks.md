# Work Packages: Obsidian Agent Integration Suite

**Inputs**: Design documents from `/kitty-specs/007-obsidian-agent-integration-suite/`
**Prerequisites**: plan.md (required), spec.md (user stories).

**Tests**: Only include explicit testing work when stakeholders request it.

**Organization**: Fine-grained subtasks (`Txxx`) roll up into work packages (`WPxx`). Each work package must be independently deliverable and testable.

**Prompt Files**: Each work package references a matching prompt file in `/tasks/` generated by `/spec-kitty.tasks`. Treat this file as the high-level checklist; keep deep implementation detail inside the prompt files.

## Subtask Format: `[Txxx] [P?] Description`
- **[P]** indicates the subtask can proceed in parallel within the same context.
- Include precise file paths or modules.

---

## Work Package WP01: Research Obsidian Integration Strategy & Capability Overlap (Priority: P1)

**Goal**: Determine strategy and assess capability overlap with RLM/Vector DB.
**Independent Test**: ADR approved detailing the chosen architecture and capability pivot points.
**Prompt**: `/tasks/WP01-research-integration-strategy.md`

### Included Subtasks
- [ ] T001 Analyze Obsidian's core mechanisms (Local REST API, direct Markdown, Custom Plugin).
- [ ] T002 Analyze capability overlap with `rlm-factory` and `vector-db` plugins.
- [ ] T003 Draft ADR detailing the chosen read/write strategy and capability alignment.
- [ ] T004 Obtain human steward approval on the ADR.

### Implementation Notes
- Crucial that WP01 is completely resolved before WP03 and WP04 begin.

### Parallel Opportunities
- None. Needs strictly sequential resolution.

### Dependencies
- None.

### Risks & Mitigations
- Foundational error risk. Mitigation: strict human review gate for the ADR.

---

## Work Package WP02: Research Data Mapping to HF Schema (Priority: P2)

**Goal**: Define JSONL data mapping rules and explicitly ignore attachment logic.
**Independent Test**: ADR approved defining the `source_path` flattening strategy.
**Prompt**: `/tasks/WP02-data-mapping-hf-schema.md`

### Included Subtasks
- [ ] T005 Analyze HF `soul_traces.jsonl` schema (ADR 081).
- [ ] T006 Define exact mapping rules for nested folders via `source_path`.
- [ ] T007 Formalize the rule that images and binary attachments are strictly ignored.
- [ ] T008 Draft ADR detailing the mapping strategy.
- [ ] T009 Obtain human steward approval on the mapping ADR.

### Implementation Notes
- Can run concurrently with WP01 since it does not depend on *how* we access the data, only *what* data maps to what HF structure.

### Parallel Opportunities
- Entire package can run parallel to WP01.

### Dependencies
- None.

### Risks & Mitigations
- Schema violation risk. Mitigation: strictly align with ADR 081 definitions.

---

## Work Package WP03: Build Obsidian CRUD Skill (Priority: P1)

**Goal**: Establish base agent skill for note interaction.
**Independent Test**: Create, read, and append to a note autonomously.
**Prompt**: `/tasks/WP03-build-obsidian-crud-skill.md`

### Included Subtasks
- [ ] T010 Create `obsidian-crud` plugin directory and SKILL.md.
- [ ] T011 Implement read mechanisms per WP01 ADR.
- [ ] T012 Implement create/update mechanisms per WP01 ADR.
- [ ] T013 Write unit verification tests for note lifecycle.

### Implementation Notes
- Implementation hinges on the architecture chosen in WP01.

### Parallel Opportunities
- T011 and T012 can be mapped out in parallel once framework is set.

### Dependencies
- Depends on: WP01.

### Risks & Mitigations
- File corruption. Mitigation: safe file-locks if using direct filesystem access.

---

## Work Package WP04: Build Obsidian Graph Traversal Skill (Priority: P2)

**Goal**: Enable semantic link traversal for context bridging.
**Independent Test**: Identify a 5-node relationship accurately.
**Prompt**: `/tasks/WP04-build-obsidian-graph-skill.md`

### Included Subtasks
- [ ] T014 Create `obsidian-graph` plugin directory and SKILL.md.
- [ ] T015 Implement link parsing logic to identify wikilinks.
- [ ] T016 Implement backlink resolution.
- [ ] T017 Implement forward link resolution.
- [ ] T018 Write verification tests for 3-back, 2-forward node relationship.

### Implementation Notes
- Purely read-only; heavily string/semantic parsing focused.

### Parallel Opportunities
- Can be run in parallel with WP03.

### Dependencies
- Depends on: WP01.

### Risks & Mitigations
- Performance scaling. Mitigation: caching mechanisms if scanning vault dynamically.

---

## Work Package WP05: Build 'Forge Soul' Semantic Exporter Skill (Priority: P2)

**Goal**: Securely format and export sealed knowledge to Hugging Face JSONL.
**Independent Test**: Valid JSONL push after passing Git verification gate.
**Prompt**: `/tasks/WP05-build-forge-soul-skill.md`

### Included Subtasks
- [ ] T019 Create `forge-soul` plugin directory and SKILL.md.
- [ ] T020 Implement Git Pre-Flight Check (Protocol 101) logic.
- [ ] T021 Implement logic to identify sealed notes.
- [ ] T022 Implement data transformation logic perfectly adhering to WP02 schema rules.
- [ ] T023 Implement the export/append step to Hugging Face `soul_traces.jsonl`.
- [ ] T024 Write tests validating schema compliance and Git failure blocks.

### Implementation Notes
- This is the highest risk integration point. Git verification gate must fail hard on uncommitted work.

### Parallel Opportunities
- T020 (Git Check) and T022 (Data transform) can run in parallel.

### Dependencies
- Depends on: WP02.

### Risks & Mitigations
- Vault sync corruption. Mitigation: strict HF testing validations and the mandatory Protocol 101 gate.

---

## Work Package WP06: Legacy Scrubbing & Automated Link Refactoring (Priority: P3)

**Goal**: Remove obsolete architecture and fix broken repo paths.
**Independent Test**: 0 broken links, 0 'MCP' usages in core setup.
**Prompt**: `/tasks/WP06-legacy-scrubbing.md`

### Included Subtasks
- [ ] T025 Develop a script to detect and convert `[Link](../../file.md)` into Obsidian wikilinks (`[[file]]`).
- [ ] T026 Apply refactoring across `01_PROTOCOLS/` and `02_LEARNING/`.
- [ ] T027 Scrub all outdated "MCP" references from `sanctuary-guardian-prompt.md`.
- [ ] T028 Verify clean `grep` results for "mcp ".

### Implementation Notes
- Global regexes needed.

### Parallel Opportunities
- Link conversion and MCP scrubbing are fully independent.

### Dependencies
- None. Can be done immediately.

### Risks & Mitigations
- Over-aggressive regex matching. Mitigation: strictly bind search domain.

---
