# Implementation Plan: [FEATURE]
*Path: [templates/plan-template.md](templates/plan-template.md)*


**Branch**: `007-obsidian-agent-integration-suite` | **Date**: 2026-02-26 | **Spec**: [kitty-specs/007-obsidian-agent-integration-suite/spec.md](spec.md)
**Input**: Feature specification from `/kitty-specs/007-obsidian-agent-integration-suite/spec.md`

## Summary

The Obsidian Agent Integration Suite replaces the legacy monolithic sync script with a modular Plugin-and-Skills ecosystem. 
It establishes a formalized integration strategy (ADRs for architecture and data mapping) and provides autonomous agents with explicit skills to interact with the local vault (CRUD operations, Graph traversal) and export sealed knowledge fragments to Hugging Face JSONL format (`soul_traces.jsonl`).

## Technical Context

**Language/Version**: Python 3.13 
**Primary Dependencies**: `datasets`, `huggingface_hub`, built-in JSON/Pathlib. The integration strategy is explicitly deferred to Phase 0 Research (WP01). WP01 MUST aggressively evaluate Obsidian's capabilities to determine overlap with our existing `rlm-factory` and `vector-db` plugins.   
**Storage**: Local Filesystem (Obsidian Markdown Vault) & Hugging Face Hub (JSONL)  
**Testing**: Unittest framework, local dry-run verifications.  
**Target Platform**: CLI / Agent Environment.
**Project Type**: Python Plugin ecosystem (`plugins/` directory). 
**Performance Goals**: Fast graph traversal (< 2 seconds for a graph of 50 links). Seamless linking between disparate research files.
**Constraints**: Must strictly adhere to the Hugging Face `soul_traces.jsonl` schema (ADR 081). Must handle rate limits and strictly ignore large binary attachments. Must enforce Atomic Writes and Advisory Locks when modifying active vaults to prevent silent corruption.
**Scale/Scope**: 10 Work Packages representing Research (ADRs), 6 Agent Skills + 1 Shared Parser Utility, 1 Cleanup Task, and 1 Integration Testing Suite.

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

- [x] **Zero Trust Git**: Ensure WP09 (Forge Soul) does not push to HF without a Git clean-state check.
- [x] **Tool Discovery**: Ensure agent dependencies on `rlm-factory` and `vector-db` are explicitly audited in WP01.
- [x] **Docs First**: ADR must precede code for both the Obsidian Integration Strategy and the HF Data Mapping.

## Project Structure

### Documentation (this feature)

```
kitty-specs/[###-feature]/
├── plan.md              # This file (/spec-kitty.plan command output)
├── research.md          # Phase 0 output (/spec-kitty.plan command)
├── data-model.md        # Phase 1 output (/spec-kitty.plan command)
├── quickstart.md        # Phase 1 output (/spec-kitty.plan command)
├── contracts/           # Phase 1 output (/spec-kitty.plan command)
└── tasks.md             # Phase 2 output (/spec-kitty.tasks command - NOT created by /spec-kitty.plan)
```

### Source Code (repository root)

```
```text
plugins/obsidian-integration/
├── obsidian-parser/            # Shared proprietary markdown parser
├── skills/
│   ├── obsidian-markdown-mastery/
│   ├── obsidian-vault-crud/
│   ├── obsidian-graph-traversal/
│   ├── obsidian-bases-manager/
│   ├── obsidian-canvas-architect/
│   └── forge-soul-exporter/
└── templates/                  # Synthetic testing vaults
```

**Structure Decision**: This feature will establish a new `obsidian-integration` plugin containing the 6 autonomous skills outlined in `obsidian-plugin-architecture.md`, cleanly separating the system from legacy MCP logic. A shared `obsidian-parser` module will anchor the varied wikilink and callout syntaxes to prevent regex fragmentation across the skills.

## Work Packages

The implementation of `007-obsidian-agent-integration-suite` is structured into 10 sequential Work Packages (WPs). Note that `tasks.md` will be formally generated by the `/spec-kitty.tasks` command based on this plan.

1. **WP01: Research Obsidian Integration Strategy & Capability Overlap (ADR)**
   - **Goal:** Determine the architectural pattern for reading/writing Obsidian nodes. Map Obsidian's native capabilities against Project Sanctuary's existing `rlm-factory` and `vector-db` skills.
   - **Output:** An approved Architectural Decision Record (ADR) detailing the chosen strategy (Direct Filesystem + Antigravity Multi-root) and defining the 6 required Plugin Skills.

2. **WP02: Deep Analyze Kepano Obsidian Skills Repository**
   - **Goal:** Clone `https://github.com/kepano/obsidian-skills` into a temporary directory and perform a deep analysis of its codebase to identify best practices, potential overlaps, and standard approaches to bridging agents with Obsidian.
   - **Output:** An architectural synthesis report documenting code patterns and specific integrations that can map into our own sovereign plugin ecosystem.

3. **WP03: Research Data Mapping to HF Schema (ADR)**
   - **Goal:** Analyze nested folder and frontmatter mapping to the existing `HF_JSONL` schema (ADR 081). Ignore binary attachments.
   - **Output:** An approved ADR detailing how `source_path` metadata replaces physical directory nesting, explicitly noting unsupported edge cases.

4. **WP04: Legacy Scrubbing & Automated Link Refactoring**
   - **Goal:** Remove references to obsolete "MCP architecture". Develop a Python script (with a mandatory Dry-Run preview) to convert legacy relative markdown links into Obsidian wikilinks (`[[file]]`) across `01_PROTOCOLS/` and `02_LEARNING/`.
   - **Output:** Clean `grep` results for "MCP", and safe wikilink refactoring to establish a clean graph for downstream traversal tests.

5. **WP05: Build Obsidian Markdown Mastery Skill**
   - **Goal:** Implement the formatting controller skill (`obsidian-markdown-mastery`) and the shared `obsidian-parser` module.
   - **Output:** A self-contained utility that handles all complex link mapping (`[[Note|Alias]]`, `[[Note#^block]]`, Embeds) and acts as the gatekeeper for all vault I/O.

6. **WP06: Build Obsidian Vault CRUD Skill**
   - **Goal:** Implement the `obsidian-vault-crud` plugin skill for interacting with standard Markdown notes.
   - **Output:** A verified agent skill utilizing Atomic Writes (POSIX rename) and a `.agent-lock` protocol for human-active vaults.

7. **WP07: Build Obsidian Dynamic Views Skills (Bases & Canvas)**
   - **Goal:** Implement the `obsidian-bases-manager` and `obsidian-canvas-architect` plugin skills.
   - **Output:** Agent Skills capable of reading/updating `.base` and `.canvas` files, featuring lossless YAML parsing (`ruamel.yaml`) and forward-compatible schema logic.

8. **WP08: Build Obsidian Graph Traversal Skill**
   - **Goal:** Implement the `obsidian-graph-traversal`, anchored by the shared `obsidian-parser` utility index built in WP05.
   - **Output:** Verified traversal skill utilizing a lightweight in-memory cache index to natively resolve global wikilink ambiguities and backward link references accurately in < 2 seconds.

9. **WP09: Build 'Forge Soul' Semantic Exporter Skill**
   - **Goal:** Implement the `forge-soul-exporter` plugin to format sealed knowledge into `soul_traces.jsonl`.
   - **Output:** A verified semantic export pipeline that enforces an absolute **Snapshot Isolation Lock** (tree hash parity) during the run, failing instantly if file `mtime` changes are detected midway to avoid exporting fragmented notes.

10. **WP10: Phase 1.5 Integration & Synthetic Edge-Case Testing**
   - **Goal:** Provide end-to-end integration safety.
   - **Output:** A synthetic testing vault loaded with 100+ edge-case notes (e.g., malformed YAML, complex block transclusions, spaces in paths). Run an end-to-end simulated concurrent read/write test and a dry run of the Forge Soul export.