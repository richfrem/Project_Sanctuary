# Feature Specification: Obsidian Agent Integration Suite

**Feature Branch**: `[007-obsidian-agent-integration-suite]`  
**Category**: Feature
**Created**: 2026-02-26
**Status**: Draft  
**Input**: User description: "Integrate Obsidian notes with Hugging Face's JSONL dataset format for use in learning loops. The sync process will be one component of a modular ecosystem. The feature must be broken down into formal Work Packages (WPs): (1) Research Obsidian integration methods (Local REST API vs. custom TypeScript plugin vs. direct Markdown parsing) and create an ADR. (2) Build a skill/plugin for basic note creation and reading. (3) Build a skill/plugin for graph traversal. (4) Build the 'Forge Soul' export skill to handle JSONL transformation. (5) Define a WP to analyze how data types map to our HF schema. (6) Clean up dead links and outdated MCP references."

## Purpose and Objectives (The "Why")

The core objective of the **Obsidian Agent Integration Suite** is to replace the fragile, monolithic sync script with a formalized, agentic ecosystem for knowledge management. This serves five massive architectural and strategic goals:

1. **Shift from Fragmented Ad-Hoc Storage to Automatic Linking**: We are moving away from an approach where memory is preserved across disjointed, manually created folders. Adopting a robust Obsidian vault model enables automatic bidirectional linking and gives agents a structured graph to interact with.
2. **Pre-Vault Curation and Validation**: The new ecosystem will force agents to curate, update, and validate all key content *before* it is loaded into the vault. This ensures that the vault only ever contains current, verified information with zero broken links.
3. **Leverage the Broader Ecosystem**: By adopting a formalized Obsidian vault structure, Project Sanctuary can seamlessly leverage the constant improvements, plugins, and tooling generated by the massive broader open-source Obsidian developer community.
4. **Graphical Exploration**: The integration provides new, powerful opportunities to explore the organic links between research and learning through Obsidian's native graph view and visual relationship mapping.
5. **Capability Overlap Research (WP01)**: Before writing integration code, we must aggressively research Obsidian's native capabilities. We need to understand if Obsidian's core features overlap with, replace, or sit underneath our existing `rlm-factory` (distillation, curation) and `vector-db` (semantic search) skills. The outcomes of this research may dramatically pivot our implementation plans.

While the "Soul Delivery" phase remains unchanged—we will still definitively export sealed knowledge to Hugging Face JSONL and push code to GitHub—the *method* of how agents organize, retrieve, and validate that knowledge locally is fundamentally upgrading.

## User Scenarios & Testing *(mandatory)*

### User Story 1 - Research & Define Integration Strategy (Priority: P1)

The system needs a formalized strategy for interacting with the local Obsidian vault. This goes beyond just API vs. Plugin decisions; we must aggressively research Obsidian's native capabilities to understand how they intersect with our existing `rlm-factory` and `vector-db` agent skills. If Obsidian provides native semantic search or distillation overlap, the architecture must pivot to accommodate it.

**Why this priority**: We cannot build reliable skills or assume we need to rebuild semantic search without a defined, approved interface pattern and capability map for Obsidian.
**Independent Test**: Can be fully tested by reviewing the generated ADR document and getting human steward approval on the proposed strategy and capability overlap.

**Acceptance Scenarios**:
1. **Given** the need to integrate with Obsidian, **When** the research phase is complete, **Then** an ADR is published detailing the chosen integration method (Markdown/REST/Plugin) AND an analysis of how Obsidian's capabilities affect our `rlm-factory` and `vector-db` skills.

---

### User Story 2 - Basic Note CRUD Skill (Priority: P1)

Agents require a dedicated skill to create, read, and update notes within the Obsidian vault, utilizing the strategy defined in User Story 1.

**Why this priority**: Fundamental capability required before any advanced traversal or exporting can take place.
**Independent Test**: Can be fully tested by having an agent use the skill to create a test note, read its contents, update it, and verify the changes on disk.

**Acceptance Scenarios**:
1. **Given** a valid Obsidian vault path, **When** an agent invokes the read/write skill, **Then** the note is accurately retrieved or created.

---

### User Story 3 - Knowledge Graph Traversal Skill (Priority: P2)

Agents need the ability to traverse the Obsidian knowledge graph, identifying backlinks, forward links, and relationships between concepts without relying on basic `grep` searches.

**Why this priority**: Enables advanced contextual understanding and semantic retrieval beyond basic file reading.
**Independent Test**: Can be fully tested by providing a heavily linked note and verifying the skill correctly returns the set of connected nodes.

**Acceptance Scenarios**:
1. **Given** a target note with multiple backlinks, **When** the traversal skill is invoked, **Then** a structured list of relationship connections is returned.

---

### User Story 4 - Data Mapping Analysis (Priority: P2)

Before exporting to Hugging Face, we must analyze how complex Obsidian data types (nested folders, frontmatter arrays) map to the existing JSONL schema in ADR 081. Images and binary attachments MUST be strictly ignored.

**Why this priority**: Prevents corruption of the Hugging Face dataset by explicitly defining edge-case handling for directories.
**Independent Test**: Can be fully tested by reviewing the resulting data-mapping ADR.

**Acceptance Scenarios**:
1. **Given** an Obsidian vault with deep nesting, **When** the analysis is complete, **Then** an ADR specifies exactly how the JSONL output flattens the folder hierarchy while preserving the original `source_path` as metadata.

---

### User Story 5 - "Forge Soul" JSONL Export Skill (Priority: P2)

Agents require a skill to traverse specific sealed notes in Obsidian (e.g., `status: sealed`, `#ADR`) and transform them into the Hugging Face JSONL format (`id`, `sha256`, `timestamp`, `content`, etc.) defined in ADR 081. It must strictly ignore attachments.

**Why this priority**: This is the core objective—bridging the Obsidian brain with the external open-source LLM training dataset.
**Independent Test**: Can be fully tested by running the skill contextually and verifying the output JSONL file conforms to the Hugging Face dataset schema without errors.

**Acceptance Scenarios**:
1. **Given** a set of tagged Obsidian notes, **When** the Forge Soul skill is called contextually, **Then** it performs a Git Pre-Flight check and generates a compliant JSONL payload.

---

### User Story 6 - Cleanup & Legacy Scrubbing (Priority: P3)

The repository contains broken links from moved files and outdated references to the legacy "MCP" architecture. These must be scrubbed across the repository, and all relative Markdown links in the `01_PROTOCOLS/` and `02_LEARNING/` directories must be refactored into Obsidian wikilinks.

**Why this priority**: Ensures documentation integrity and builds the foundation for the Obsidian graph view.
**Independent Test**: Can be fully tested by verifying 0 instances of "MCP" in the core prompts and confirming relative links (e.g., `[Link](../../file.md)`) have been transformed into `[[file]]`.

**Acceptance Scenarios**:
1. **Given** legacy documentation, **When** the cleanup WP is executed, **Then** MCP references are removed and Automated Link Refactoring completes successfully.


### Edge Cases

- What happens when an Obsidian file contains malformed or missing frontmatter?
- How does system handle Obsidian Vault paths containing spaces or special characters?
- What happens if the Hugging Face API is rate-limited during the JSONL export?

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: System MUST formally define the Obsidian integration strategy via an Architecture Decision Record (ADR) before implementation.
- **FR-002**: System MUST provide an Agent Skill for basic note creation and retrieval.
- **FR-003**: System MUST provide an Agent Skill capable of parsing Obsidian internal links (e.g., `[[Note Title]]`) and returning a relationship graph.
- **FR-004**: System MUST strictly ignore images and binary attachments. The mapping ADR MUST solely determine how nested directory pathing maps to the JSONL `source_path` metadata. 
- **FR-005**: System MUST provide an Agent Skill ("Forge Soul") that parses matched Obsidian notes and formats them into the JSONL schema from ADR 081. This skill MUST execute a Git Pre-Flight Check (Protocol 101) verifying no uncommitted drift exists before executing the Hugging Face sync.
- **FR-006**: The "Forge Soul" sync MUST NOT be a scheduled chron job; it MUST be an Agent Skill invoked contextually by the orchestrator.
- **FR-007**: System MUST perform Automated Link Refactoring across `01_PROTOCOLS/` and `02_LEARNING/` to convert legacy relative paths (e.g., `[Link](../../file.md)`) into proper Obsidian wikilinks (`[[file]]`), alongside scrubbing "MCP" references.

### Key Entities 

- **ObsidianNode**: Represents a single markdown file in the vault, including its parsed frontmatter metadata and internal relationships.
- **SoulRecord**: The JSONL representation of a sealed node, patterned after ADR 081 (`id`, `sha256`, `timestamp`, `content`, `valence`).

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: ADRs are approved for both strategy (Integration) and data mapping (Attachments).
- **SC-002**: Agents can successfully create and read Obsidian notes through the new skill without manual human intervention.
- **SC-003**: A test note with 3 backlinks and 2 forward links returns a correct 5-node relationship graph via the traversal skill.
- **SC-004**: Running the "Forge Soul" skill generates a valid JSONL payload that passes Hugging Face schema validation, and explicitly fails if uncommitted Git changes are present.
- **SC-005**: `grep -i "mcp "` run against `.agent/` and `plugins/guardian-onboarding/` returns zero results, and relative links in `01_PROTOCOLS/` and `02_LEARNING/` are successfully refactored to wikilinks.
