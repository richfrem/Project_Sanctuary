============================= test session starts ==============================
platform darwin -- Python 3.13.4, pytest-8.4.1, pluggy-1.6.0 -- /usr/local/bin/python3
cachedir: .pytest_cache
benchmark: 5.2.3 (defaults: timer=time.perf_counter disable_gc=False min_rounds=5 min_time=0.000005 max_time=1.0 calibration_precision=10 warmup=False warmup_iterations=100000)
rootdir: /Users/richardfremmerlid/Projects/Project_Sanctuary
configfile: pytest.ini
plugins: benchmark-5.2.3, anyio-4.9.0, langsmith-0.4.31, cov-6.2.1, typeguard-4.4.4
collecting ... collected 1 item

tests/mcp_servers/orchestrator/e2e/test_protocol_056_headless.py::TestProtocol056Headless::test_triple_loop_scenario 
-------------------------------- live log setup --------------------------------
INFO     tests.mcp_servers.base.mcp_server_fleet:mcp_server_fleet.py:21 Starting MCP Server Fleet...
INFO     tests.mcp_servers.base.mcp_server_fleet:mcp_server_fleet.py:40 Booting adr...
INFO     tests.mcp_servers.base.mcp_test_client:mcp_test_client.py:31 Starting MCP Server: /usr/local/bin/python3 /Users/richardfremmerlid/Projects/Project_Sanctuary/mcp_servers/adr/server.py
INFO     tests.mcp_servers.base.mcp_test_client:mcp_test_client.py:42 Server started (PID 88932)
INFO     tests.mcp_servers.base.mcp_server_fleet:mcp_server_fleet.py:40 Booting agent_persona...
INFO     tests.mcp_servers.base.mcp_test_client:mcp_test_client.py:31 Starting MCP Server: /usr/local/bin/python3 /Users/richardfremmerlid/Projects/Project_Sanctuary/mcp_servers/agent_persona/server.py
INFO     tests.mcp_servers.base.mcp_test_client:mcp_test_client.py:42 Server started (PID 88933)
INFO     tests.mcp_servers.base.mcp_server_fleet:mcp_server_fleet.py:40 Booting chronicle...
INFO     tests.mcp_servers.base.mcp_test_client:mcp_test_client.py:31 Starting MCP Server: /usr/local/bin/python3 /Users/richardfremmerlid/Projects/Project_Sanctuary/mcp_servers/chronicle/server.py
INFO     tests.mcp_servers.base.mcp_test_client:mcp_test_client.py:42 Server started (PID 88934)
INFO     tests.mcp_servers.base.mcp_server_fleet:mcp_server_fleet.py:40 Booting code...
INFO     tests.mcp_servers.base.mcp_test_client:mcp_test_client.py:31 Starting MCP Server: /usr/local/bin/python3 /Users/richardfremmerlid/Projects/Project_Sanctuary/mcp_servers/code/server.py
INFO     tests.mcp_servers.base.mcp_test_client:mcp_test_client.py:42 Server started (PID 88935)
INFO     tests.mcp_servers.base.mcp_server_fleet:mcp_server_fleet.py:40 Booting config...
INFO     tests.mcp_servers.base.mcp_test_client:mcp_test_client.py:31 Starting MCP Server: /usr/local/bin/python3 /Users/richardfremmerlid/Projects/Project_Sanctuary/mcp_servers/config/server.py
INFO     tests.mcp_servers.base.mcp_test_client:mcp_test_client.py:42 Server started (PID 88936)
INFO     tests.mcp_servers.base.mcp_server_fleet:mcp_server_fleet.py:40 Booting council...
INFO     tests.mcp_servers.base.mcp_test_client:mcp_test_client.py:31 Starting MCP Server: /usr/local/bin/python3 /Users/richardfremmerlid/Projects/Project_Sanctuary/mcp_servers/council/server.py
INFO     tests.mcp_servers.base.mcp_test_client:mcp_test_client.py:42 Server started (PID 88937)
INFO     tests.mcp_servers.base.mcp_server_fleet:mcp_server_fleet.py:40 Booting forge_llm...
INFO     tests.mcp_servers.base.mcp_test_client:mcp_test_client.py:31 Starting MCP Server: /usr/local/bin/python3 /Users/richardfremmerlid/Projects/Project_Sanctuary/mcp_servers/forge_llm/server.py
INFO     tests.mcp_servers.base.mcp_test_client:mcp_test_client.py:42 Server started (PID 88938)
INFO     tests.mcp_servers.base.mcp_server_fleet:mcp_server_fleet.py:40 Booting git...
INFO     tests.mcp_servers.base.mcp_test_client:mcp_test_client.py:31 Starting MCP Server: /usr/local/bin/python3 /Users/richardfremmerlid/Projects/Project_Sanctuary/mcp_servers/git/server.py
INFO     tests.mcp_servers.base.mcp_test_client:mcp_test_client.py:42 Server started (PID 88939)
INFO     tests.mcp_servers.base.mcp_server_fleet:mcp_server_fleet.py:40 Booting orchestrator...
INFO     tests.mcp_servers.base.mcp_test_client:mcp_test_client.py:31 Starting MCP Server: /usr/local/bin/python3 /Users/richardfremmerlid/Projects/Project_Sanctuary/mcp_servers/orchestrator/server.py
INFO     tests.mcp_servers.base.mcp_test_client:mcp_test_client.py:42 Server started (PID 88940)
INFO     tests.mcp_servers.base.mcp_server_fleet:mcp_server_fleet.py:40 Booting protocol...
INFO     tests.mcp_servers.base.mcp_test_client:mcp_test_client.py:31 Starting MCP Server: /usr/local/bin/python3 /Users/richardfremmerlid/Projects/Project_Sanctuary/mcp_servers/protocol/server.py
INFO     tests.mcp_servers.base.mcp_test_client:mcp_test_client.py:42 Server started (PID 88941)
INFO     tests.mcp_servers.base.mcp_server_fleet:mcp_server_fleet.py:40 Booting rag_cortex...
INFO     tests.mcp_servers.base.mcp_test_client:mcp_test_client.py:31 Starting MCP Server: /usr/local/bin/python3 /Users/richardfremmerlid/Projects/Project_Sanctuary/mcp_servers/rag_cortex/server.py
INFO     tests.mcp_servers.base.mcp_test_client:mcp_test_client.py:42 Server started (PID 88942)
INFO     tests.mcp_servers.base.mcp_server_fleet:mcp_server_fleet.py:40 Booting task...
INFO     tests.mcp_servers.base.mcp_test_client:mcp_test_client.py:31 Starting MCP Server: /usr/local/bin/python3 /Users/richardfremmerlid/Projects/Project_Sanctuary/mcp_servers/task/server.py
INFO     tests.mcp_servers.base.mcp_test_client:mcp_test_client.py:42 Server started (PID 88943)
INFO     tests.mcp_servers.base.mcp_server_fleet:mcp_server_fleet.py:45 Fleet started with 12 servers.
-------------------------------- live log call ---------------------------------
INFO     orchestrator.e2e.test_protocol_056_headless:test_protocol_056_headless.py:28 Checking Code MCP connectivity...
FAILED
------------------------------ live log teardown -------------------------------
INFO     tests.mcp_servers.base.mcp_server_fleet:mcp_server_fleet.py:49 Stopping MCP Server Fleet...
INFO     tests.mcp_servers.base.mcp_server_fleet:mcp_server_fleet.py:51 Stopping adr...
INFO     tests.mcp_servers.base.mcp_test_client:mcp_test_client.py:52 Server stopped
INFO     tests.mcp_servers.base.mcp_server_fleet:mcp_server_fleet.py:51 Stopping agent_persona...
INFO     tests.mcp_servers.base.mcp_test_client:mcp_test_client.py:52 Server stopped
INFO     tests.mcp_servers.base.mcp_server_fleet:mcp_server_fleet.py:51 Stopping chronicle...
INFO     tests.mcp_servers.base.mcp_test_client:mcp_test_client.py:52 Server stopped
INFO     tests.mcp_servers.base.mcp_server_fleet:mcp_server_fleet.py:51 Stopping code...
INFO     tests.mcp_servers.base.mcp_test_client:mcp_test_client.py:52 Server stopped
INFO     tests.mcp_servers.base.mcp_server_fleet:mcp_server_fleet.py:51 Stopping config...
INFO     tests.mcp_servers.base.mcp_test_client:mcp_test_client.py:52 Server stopped
INFO     tests.mcp_servers.base.mcp_server_fleet:mcp_server_fleet.py:51 Stopping council...
INFO     tests.mcp_servers.base.mcp_test_client:mcp_test_client.py:52 Server stopped
INFO     tests.mcp_servers.base.mcp_server_fleet:mcp_server_fleet.py:51 Stopping forge_llm...
INFO     tests.mcp_servers.base.mcp_test_client:mcp_test_client.py:52 Server stopped
INFO     tests.mcp_servers.base.mcp_server_fleet:mcp_server_fleet.py:51 Stopping git...
INFO     tests.mcp_servers.base.mcp_test_client:mcp_test_client.py:52 Server stopped
INFO     tests.mcp_servers.base.mcp_server_fleet:mcp_server_fleet.py:51 Stopping orchestrator...
INFO     tests.mcp_servers.base.mcp_test_client:mcp_test_client.py:52 Server stopped
INFO     tests.mcp_servers.base.mcp_server_fleet:mcp_server_fleet.py:51 Stopping protocol...
INFO     tests.mcp_servers.base.mcp_test_client:mcp_test_client.py:52 Server stopped
INFO     tests.mcp_servers.base.mcp_server_fleet:mcp_server_fleet.py:51 Stopping rag_cortex...
INFO     tests.mcp_servers.base.mcp_test_client:mcp_test_client.py:52 Server stopped
INFO     tests.mcp_servers.base.mcp_server_fleet:mcp_server_fleet.py:51 Stopping task...
INFO     tests.mcp_servers.base.mcp_test_client:mcp_test_client.py:52 Server stopped


=================================== FAILURES ===================================
______________ TestProtocol056Headless.test_triple_loop_scenario _______________

self = <orchestrator.e2e.test_protocol_056_headless.TestProtocol056Headless object at 0x1081c2350>
mcp_fleet = <tests.mcp_servers.base.mcp_server_fleet.MCPServerFleet object at 0x108137770>

    @pytest.mark.e2e
    def test_triple_loop_scenario(self, mcp_fleet):
        """
        Executes the 3-cycle recursive validation loop using headless MCP servers.
    
        Ref: TASKS/in-progress/109_implement_protocol_056_headless_tripleloop_e2e_tes.md
        """
        # 1. Setup Clients
        code_client = mcp_fleet.get_client("code")
        cortex_client = mcp_fleet.get_client("rag_cortex")
        chronicle_client = mcp_fleet.get_client("chronicle")
    
        # 0. Connectivity Check
        logger.info("Checking Code MCP connectivity...")
>       files = code_client.call_tool("code_list_files", {"directory": "DOCS"})
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/mcp_servers/orchestrator/e2e/test_protocol_056_headless.py:29: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <tests.mcp_servers.base.mcp_test_client.MCPTestClient object at 0x10819d810>
name = 'code_list_files', arguments = {'directory': 'DOCS'}

    def call_tool(self, name: str, arguments: Dict[str, Any] = {}) -> Any:
        """Call an MCP tool and return the result."""
        self.request_id += 1
        request = {
            "jsonrpc": "2.0",
            "id": self.request_id,
            "method": "tools/call",
            "params": {
                "name": name,
                "arguments": arguments
            }
        }
    
        # Send Request
        if not self.process or not self.process.stdin:
            raise RuntimeError("Server not running")
    
        json_str = json.dumps(request) + "\n"
        self.process.stdin.write(json_str)
        self.process.stdin.flush()
    
        # Read Response
        # Note: In a real protocol, we might receive notifications or other requests.
        # This simple client assumes request-response for now.
        while True:
            response = self._read_response()
    
            if response.get("id") == self.request_id:
                if "error" in response:
>                   raise RuntimeError(f"Tool execution failed: {response['error']}")
E                   RuntimeError: Tool execution failed: {'code': -32602, 'message': 'Invalid request parameters', 'data': ''}

tests/mcp_servers/base/mcp_test_client.py:105: RuntimeError
------------------------------ Captured log setup ------------------------------
INFO     tests.mcp_servers.base.mcp_server_fleet:mcp_server_fleet.py:21 Starting MCP Server Fleet...
INFO     tests.mcp_servers.base.mcp_server_fleet:mcp_server_fleet.py:40 Booting adr...
INFO     tests.mcp_servers.base.mcp_test_client:mcp_test_client.py:31 Starting MCP Server: /usr/local/bin/python3 /Users/richardfremmerlid/Projects/Project_Sanctuary/mcp_servers/adr/server.py
INFO     tests.mcp_servers.base.mcp_test_client:mcp_test_client.py:42 Server started (PID 88932)
INFO     tests.mcp_servers.base.mcp_server_fleet:mcp_server_fleet.py:40 Booting agent_persona...
INFO     tests.mcp_servers.base.mcp_test_client:mcp_test_client.py:31 Starting MCP Server: /usr/local/bin/python3 /Users/richardfremmerlid/Projects/Project_Sanctuary/mcp_servers/agent_persona/server.py
INFO     tests.mcp_servers.base.mcp_test_client:mcp_test_client.py:42 Server started (PID 88933)
INFO     tests.mcp_servers.base.mcp_server_fleet:mcp_server_fleet.py:40 Booting chronicle...
INFO     tests.mcp_servers.base.mcp_test_client:mcp_test_client.py:31 Starting MCP Server: /usr/local/bin/python3 /Users/richardfremmerlid/Projects/Project_Sanctuary/mcp_servers/chronicle/server.py
INFO     tests.mcp_servers.base.mcp_test_client:mcp_test_client.py:42 Server started (PID 88934)
INFO     tests.mcp_servers.base.mcp_server_fleet:mcp_server_fleet.py:40 Booting code...
INFO     tests.mcp_servers.base.mcp_test_client:mcp_test_client.py:31 Starting MCP Server: /usr/local/bin/python3 /Users/richardfremmerlid/Projects/Project_Sanctuary/mcp_servers/code/server.py
INFO     tests.mcp_servers.base.mcp_test_client:mcp_test_client.py:42 Server started (PID 88935)
INFO     tests.mcp_servers.base.mcp_server_fleet:mcp_server_fleet.py:40 Booting config...
INFO     tests.mcp_servers.base.mcp_test_client:mcp_test_client.py:31 Starting MCP Server: /usr/local/bin/python3 /Users/richardfremmerlid/Projects/Project_Sanctuary/mcp_servers/config/server.py
INFO     tests.mcp_servers.base.mcp_test_client:mcp_test_client.py:42 Server started (PID 88936)
INFO     tests.mcp_servers.base.mcp_server_fleet:mcp_server_fleet.py:40 Booting council...
INFO     tests.mcp_servers.base.mcp_test_client:mcp_test_client.py:31 Starting MCP Server: /usr/local/bin/python3 /Users/richardfremmerlid/Projects/Project_Sanctuary/mcp_servers/council/server.py
INFO     tests.mcp_servers.base.mcp_test_client:mcp_test_client.py:42 Server started (PID 88937)
INFO     tests.mcp_servers.base.mcp_server_fleet:mcp_server_fleet.py:40 Booting forge_llm...
INFO     tests.mcp_servers.base.mcp_test_client:mcp_test_client.py:31 Starting MCP Server: /usr/local/bin/python3 /Users/richardfremmerlid/Projects/Project_Sanctuary/mcp_servers/forge_llm/server.py
INFO     tests.mcp_servers.base.mcp_test_client:mcp_test_client.py:42 Server started (PID 88938)
INFO     tests.mcp_servers.base.mcp_server_fleet:mcp_server_fleet.py:40 Booting git...
INFO     tests.mcp_servers.base.mcp_test_client:mcp_test_client.py:31 Starting MCP Server: /usr/local/bin/python3 /Users/richardfremmerlid/Projects/Project_Sanctuary/mcp_servers/git/server.py
INFO     tests.mcp_servers.base.mcp_test_client:mcp_test_client.py:42 Server started (PID 88939)
INFO     tests.mcp_servers.base.mcp_server_fleet:mcp_server_fleet.py:40 Booting orchestrator...
INFO     tests.mcp_servers.base.mcp_test_client:mcp_test_client.py:31 Starting MCP Server: /usr/local/bin/python3 /Users/richardfremmerlid/Projects/Project_Sanctuary/mcp_servers/orchestrator/server.py
INFO     tests.mcp_servers.base.mcp_test_client:mcp_test_client.py:42 Server started (PID 88940)
INFO     tests.mcp_servers.base.mcp_server_fleet:mcp_server_fleet.py:40 Booting protocol...
INFO     tests.mcp_servers.base.mcp_test_client:mcp_test_client.py:31 Starting MCP Server: /usr/local/bin/python3 /Users/richardfremmerlid/Projects/Project_Sanctuary/mcp_servers/protocol/server.py
INFO     tests.mcp_servers.base.mcp_test_client:mcp_test_client.py:42 Server started (PID 88941)
INFO     tests.mcp_servers.base.mcp_server_fleet:mcp_server_fleet.py:40 Booting rag_cortex...
INFO     tests.mcp_servers.base.mcp_test_client:mcp_test_client.py:31 Starting MCP Server: /usr/local/bin/python3 /Users/richardfremmerlid/Projects/Project_Sanctuary/mcp_servers/rag_cortex/server.py
INFO     tests.mcp_servers.base.mcp_test_client:mcp_test_client.py:42 Server started (PID 88942)
INFO     tests.mcp_servers.base.mcp_server_fleet:mcp_server_fleet.py:40 Booting task...
INFO     tests.mcp_servers.base.mcp_test_client:mcp_test_client.py:31 Starting MCP Server: /usr/local/bin/python3 /Users/richardfremmerlid/Projects/Project_Sanctuary/mcp_servers/task/server.py
INFO     tests.mcp_servers.base.mcp_test_client:mcp_test_client.py:42 Server started (PID 88943)
INFO     tests.mcp_servers.base.mcp_server_fleet:mcp_server_fleet.py:45 Fleet started with 12 servers.
------------------------------ Captured log call -------------------------------
INFO     orchestrator.e2e.test_protocol_056_headless:test_protocol_056_headless.py:28 Checking Code MCP connectivity...
---------------------------- Captured log teardown -----------------------------
INFO     tests.mcp_servers.base.mcp_server_fleet:mcp_server_fleet.py:49 Stopping MCP Server Fleet...
INFO     tests.mcp_servers.base.mcp_server_fleet:mcp_server_fleet.py:51 Stopping adr...
INFO     tests.mcp_servers.base.mcp_test_client:mcp_test_client.py:52 Server stopped
INFO     tests.mcp_servers.base.mcp_server_fleet:mcp_server_fleet.py:51 Stopping agent_persona...
INFO     tests.mcp_servers.base.mcp_test_client:mcp_test_client.py:52 Server stopped
INFO     tests.mcp_servers.base.mcp_server_fleet:mcp_server_fleet.py:51 Stopping chronicle...
INFO     tests.mcp_servers.base.mcp_test_client:mcp_test_client.py:52 Server stopped
INFO     tests.mcp_servers.base.mcp_server_fleet:mcp_server_fleet.py:51 Stopping code...
INFO     tests.mcp_servers.base.mcp_test_client:mcp_test_client.py:52 Server stopped
INFO     tests.mcp_servers.base.mcp_server_fleet:mcp_server_fleet.py:51 Stopping config...
INFO     tests.mcp_servers.base.mcp_test_client:mcp_test_client.py:52 Server stopped
INFO     tests.mcp_servers.base.mcp_server_fleet:mcp_server_fleet.py:51 Stopping council...
INFO     tests.mcp_servers.base.mcp_test_client:mcp_test_client.py:52 Server stopped
INFO     tests.mcp_servers.base.mcp_server_fleet:mcp_server_fleet.py:51 Stopping forge_llm...
INFO     tests.mcp_servers.base.mcp_test_client:mcp_test_client.py:52 Server stopped
INFO     tests.mcp_servers.base.mcp_server_fleet:mcp_server_fleet.py:51 Stopping git...
INFO     tests.mcp_servers.base.mcp_test_client:mcp_test_client.py:52 Server stopped
INFO     tests.mcp_servers.base.mcp_server_fleet:mcp_server_fleet.py:51 Stopping orchestrator...
INFO     tests.mcp_servers.base.mcp_test_client:mcp_test_client.py:52 Server stopped
INFO     tests.mcp_servers.base.mcp_server_fleet:mcp_server_fleet.py:51 Stopping protocol...
INFO     tests.mcp_servers.base.mcp_test_client:mcp_test_client.py:52 Server stopped
INFO     tests.mcp_servers.base.mcp_server_fleet:mcp_server_fleet.py:51 Stopping rag_cortex...
INFO     tests.mcp_servers.base.mcp_test_client:mcp_test_client.py:52 Server stopped
INFO     tests.mcp_servers.base.mcp_server_fleet:mcp_server_fleet.py:51 Stopping task...
INFO     tests.mcp_servers.base.mcp_test_client:mcp_test_client.py:52 Server stopped
=========================== short test summary info ============================
FAILED tests/mcp_servers/orchestrator/e2e/test_protocol_056_headless.py::TestProtocol056Headless::test_triple_loop_scenario
============================== 1 failed in 7.06s ===============================
