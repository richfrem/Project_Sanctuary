sequenceDiagram
    autonumber
    participant User
    participant Agent
    participant pip as pip / PyPI
    participant CLI as spec-kitty CLI
    participant Kittify as .kittify/
    participant SyncScript as sync_configuration.py
    participant Plugin as plugins/spec-kitty-plugin/
    participant Bridge as bridge_installer.py
    participant Agents as Agent Environments

    User->>Agent: /spec-kitty.sync-plugin

    rect rgb(200, 210, 240)
        Note over Agent,pip: Step 1 - Upgrade CLI
        Agent->>pip: pip install --upgrade spec-kitty-cli
        pip-->>Agent: spec-kitty v1.x.x installed
        Agent->>CLI: spec-kitty --version
        CLI-->>Agent: Version confirmed
    end

    rect rgb(200, 235, 200)
        Note over Agent,Kittify: Step 2 - Refresh Templates
        Agent->>CLI: spec-kitty init . --ai windsurf --force
        CLI->>Kittify: Write command-templates/
        CLI->>Kittify: Write mission configs
        CLI->>Kittify: Write scripts/
        CLI->>Kittify: Update metadata.yaml
        CLI-->>Agent: Templates refreshed
    end

    rect rgb(245, 215, 200)
        Note over Agent,Plugin: Step 3 - Sync to Plugin
        Agent->>SyncScript: python3 sync_configuration.py
        SyncScript->>Kittify: Read command-templates/
        SyncScript->>Kittify: Read constitution.md
        SyncScript->>Plugin: Write skills/ (14 SKILL.md files)
        SyncScript->>Plugin: Write rules/
        SyncScript->>Plugin: Write templates/
        SyncScript-->>Agent: Synced N skills, N rules, N templates
    end

    rect rgb(240, 235, 200)
        Note over Agent,Agents: Step 4 - Bridge to Agents (Interactive)
        Agent->>User: Which plugins? (spec-kitty only / all)
        User-->>Agent: Selection
        Agent->>User: Which agents? (antigravity / claude / github / all)
        User-->>Agent: Selection

        alt Only spec-kitty-plugin
            Agent->>Bridge: bridge_installer.py --plugin spec-kitty-plugin --target agent
        else All plugins
            Agent->>Bridge: install_all_plugins.py --target agent
        end

        Bridge->>Plugin: Read skills/, rules/, workflows/
        Bridge->>Agents: Write to .agent/, .claude/, .github/
        Bridge-->>Agent: N plugins bridged
    end

    Agent->>User: Update complete - reload window to activate
