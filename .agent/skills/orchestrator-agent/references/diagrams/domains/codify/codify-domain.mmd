flowchart TD
    User([User / Agent])

    subgraph Commands ["Codify Domain Interface"]
        direction TB
        
        subgraph Presentation ["Presentation Layer"]
            CmdForm["/legacy-system-oracle-forms_codify-form"]
            CmdMenu["/legacy-system-oracle-forms_codify-menu"]
            CmdLib["/legacy-system-oracle-forms_codify-library"]
            CmdRep["/legacy-system-oracle-forms_codify-report"]
            CmdOLB["/legacy-system-oracle-forms_codify-olb"]
            CmdApp["/legacy-system-oracle-forms_codify-app"]
        end
        
        subgraph Database ["Database Layer"]
            CmdPkg["/legacy-system-database_codify-db-package"]
            CmdProc["/legacy-system-database_codify-db-procedure"]
            CmdFunc["/legacy-system-database_codify-db-function"]
            CmdTable["/legacy-system-database_codify-db-table"]
            CmdView["/legacy-system-database_codify-db-view"]
            CmdTrig["/legacy-system-database_codify-db-trigger"]
            CmdType["/legacy-system-database_codify-db-type"]
            CmdSeq["/legacy-system-database_codify-db-sequence"]
            CmdIdx["/legacy-system-database_codify-db-index"]
            CmdConst["/legacy-system-database_codify-db-constraint"]
        end
        
        subgraph Utility ["Utility"]
            CmdBR["/legacy-system-business-rules_codify-business-rule"]
            CmdBW["/legacy-system-business-workflows_codify-business-workflow"]
            CmdTask["/spec-kitty.tasks"]
            CmdADR["/adr-manager_create"]
        end
    end

    subgraph Investigate ["Investigate Module (Reused)"]
        InvForm["/legacy-system-oracle-forms_investigate-form"]
        InvMenu["/legacy-system-oracle-forms_investigate-menu"]
        InvDB["/legacy-system-database_investigate-db-*"]
    end

    subgraph Templates ["Standard Templates"]
        TplForm[("FORM_OVERVIEW_TEMPLATE")]
        TplDB[("DB_*_TEMPLATE")]
        TplBR[("BUSINESS_RULE_TEMPLATE")]
    end

    subgraph Output ["Final Artifacts"]
        OutOver[("legacy-system/overviews/
        *-Overview.md")]
        OutBR[("legacy-system/business-rules/
        BR-XXXX.md")]
        OutDB[("legacy-system/oracle-db-overviews/
        *-Overview.md")]
    end

    %% User to Commands
    User --> CmdForm & CmdMenu & CmdLib & CmdRep & CmdOLB & CmdApp
    User --> CmdPkg & CmdProc & CmdFunc & CmdTable & CmdView
    User --> CmdTrig & CmdType & CmdSeq & CmdIdx & CmdConst
    User --> CmdBR & CmdBW & CmdTask & CmdADR

    %% Codify calls Investigate
    CmdForm --> InvForm
    CmdMenu --> InvMenu
    CmdPkg --> InvDB
    CmdTable --> InvDB

    %% Templates
    InvForm --> TplForm
    InvDB --> TplDB
    CmdBR --> TplBR

    %% Output
    TplForm --> OutOver
    TplDB --> OutDB
    TplBR --> OutBR

    classDef command fill:#c9f,stroke:#333,stroke-width:2px;
    classDef investigate fill:#f96,stroke:#333,stroke-width:2px;
    classDef template fill:#eee,stroke:#333,stroke-width:2px;
    classDef output fill:#9f9,stroke:#333,stroke-width:2px;

    class CmdForm,CmdMenu,CmdLib,CmdRep,CmdOLB,CmdApp,CmdPkg,CmdProc,CmdFunc,CmdTable,CmdView,CmdTrig,CmdType,CmdSeq,CmdIdx,CmdConst,CmdBR,CmdBW,CmdTask,CmdADR command;
    class InvForm,InvMenu,InvDB investigate;
    class TplForm,TplDB,TplBR template;
    class OutOver,OutBR,OutDB output;
